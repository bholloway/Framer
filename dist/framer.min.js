/*

 JS Signals <http://millermedeiros.github.com/js-signals/>
 Released under the MIT license
 Author: Miller Medeiros
 Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
*/
(function(i){function h(a,b,c,d,e){this._listener=b;this._isOnce=c;this.context=d;this._signal=a;this._priority=e||0}function g(a,b){if(typeof a!=="function")throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b));}function e(){this._bindings=[];this._prevParams=null;var a=this;this.dispatch=function(){e.prototype.dispatch.apply(a,arguments)}}h.prototype={active:!0,params:null,execute:function(a){var b;this.active&&this._listener&&(a=this.params?this.params.concat(a):
a,b=this._listener.apply(this.context,a),this._isOnce&&this.detach());return b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+
", isBound:"+this.isBound()+", active:"+this.active+"]"}};e.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,b,c,d){var e=this._indexOfListener(a,c);if(e!==-1){if(a=this._bindings[e],a.isOnce()!==b)throw Error("You cannot add"+(b?"":"Once")+"() then add"+(!b?"":"Once")+"() the same listener without removing the relationship first.");}else a=new h(this,a,b,c,d),this._addBinding(a);this.memorize&&this._prevParams&&a.execute(this._prevParams);return a},
_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c=this._bindings.length,d;c--;)if(d=this._bindings[c],d._listener===a&&d.context===b)return c;return-1},has:function(a,b){return this._indexOfListener(a,b)!==-1},add:function(a,b,c){g(a,"add");return this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){g(a,"addOnce");return this._registerListener(a,
!0,b,c)},remove:function(a,b){g(a,"remove");var c=this._indexOfListener(a,b);c!==-1&&(this._bindings[c]._destroy(),this._bindings.splice(c,1));return a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b=Array.prototype.slice.call(arguments),c=this._bindings.length,d;if(this.memorize)this._prevParams=
b;if(c){d=this._bindings.slice();this._shouldPropagate=!0;do c--;while(d[c]&&this._shouldPropagate&&d[c].execute(b)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var f=e;f.Signal=e;typeof define==="function"&&define.amd?define(function(){return f}):typeof module!=="undefined"&&module.exports?module.exports=f:i.signals=
f})(this);

(function (window) {
"use strict";
function Frame(e,t,a,i){this.type=e,this.name=t,this.src=a,this.options=i,this.frameElement=void 0}function FrameMessage(e,t,a,i,s){this.type=e,this.data=t,this.origin=a,this.target=i,this.messenger=s}window.framer={managers:[],Manager:Manager,Client:Client,domLog:domLog};var ClientMessage="client",ManagerMessage="manager";
function closeFrameWindow(e){setTimeout(function(){try{e.frameElement.src="about:blank"}catch(t){}setTimeout(function(){e.frameElement.parentNode.removeChild(e.frameElement),e.frameElement=void 0},100)},0)}function createUrlArgs(e){var t=[],n=Object.getOwnPropertyNames(e);return n.forEach(function(n){var r=n+"="+encodeURI(e[n]);t.push(r)}),t.join("&")}function mergeOptions(e,t){var n=Object.getOwnPropertyNames(t);n.forEach(function(n){"undefined"==typeof e[n]&&(e[n]=t[n])})}function filterByKeyValue(e,t,n,r){var o,a=e.filter(function(e){return e[t]===n});if(a.length>0){var i=0;r&&(i=a.length-1),o=a[i]}return o}function parseParams(e){e=e||resolveHashSearch();var t=[],n=parseUris(e);for(var r in n)t.push({name:r,data:n[r]});return t}function resolveHashSearch(){if(""!==document.location.search)return document.location.search;var e=document.location.hash,t=e.substring(e.indexOf("?")+1,e.length);return t}function tryDecodeURIComponent(e){try{return decodeURIComponent(e)}catch(t){console.error("There was an issue parsing the uri segment, check your iframe src",t)}}function parseUris(e){e=e.replace(/^\?/,"");for(var t,n,r={},o=(e||"").split("&"),a=0;a<o.length;a++){var i=o[a];if(i&&(t=i.replace(/\+/g,"%20").split("="),n=tryDecodeURIComponent(t[0]),isDefined(n))){var s=isDefined(t[1])?tryDecodeURIComponent(t[1]):!0;hasOwnProperty.call(r,n)?isArray(r[n])?r[n].push(s):r[n]=[r[n],s]:r[n]=s}}return r}function prependElement(e,t){return e.insertBefore(t,e.firstChild)}function setElementStyles(e,t){for(var n in t)e.style[n]=t[n]}function setElementAttributes(e,t){for(var n in t)e.setAttribute(n,t[n]);return e}function elementExistsByClassName(e){var t=window.document.getElementsByClassName(e);return t.length>0}function isDefined(e){return"undefined"!=typeof e}function domLog(e,t){var n="dom-log",r=document.getElementsByClassName(n)[0];r||(r=document.createElement("div"),r.className=n,r.style.position="absolute",r.style.top="0",r.style.right="0",prependElement(window.document.body,r));var o=document.createElement("p");o.innerText=e,o.style.color=t,o.style.fontSize="0.5em",r.appendChild(o)}
function Manager(e,t){this.name=e,this.frames=[],this.handlers=[],this.focus=null,this.persistentFrame=null,this.zIndex=99999,t&&t.container?(this.container=t.container,this.container.className+=" "+this.name):this.container=this.createFrameContainer(this.name),this.style={position:"fixed",top:"0px",left:"0px",bottom:"0px",right:"0px",width:"100%",height:"100%",border:"none",margin:"0",padding:"0",overflow:"hidden"},this.listen();var n=signals.Signal;this.closed=new n,this.opened=new n,window.framer.managers.push(this)}Manager.prototype.receiveMessage=function(e){e.origin===document.location.origin&&(e.data.messenger!==ClientMessage||e.data.target!==this.name&&"undefined"!=typeof e.data.target||this.handleMessage(e.data))},Manager.prototype.destroy=function(){this.unListen()},Manager.prototype.listen=function(){this.listener=function(e){this.receiveMessage(e)}.bind(this),window.top.addEventListener("message",this.listener,!1)},Manager.prototype.unListen=function(){window.top.removeEventListener("message",this.listener),this.listener=void 0},Manager.prototype.send=function(e,t,n){var s=new FrameMessage(e,t,this.name,n,ManagerMessage);window.top.postMessage(s,document.location.origin)},Manager.prototype.on=function(e,t){filterByKeyValue(this.handlers,"type",e)?console.error("You already have a callback for type",e):this.handlers.push({type:e,callback:t})},Manager.prototype.add=function(e,t,n){var s=filterByKeyValue(this.frames,"name",e);if(s)return console.warn("Manager.add() there is already a frame named",e,"in the framer",this.name),s;n=n||{},isDefined(n.style)||(n.style=this.style),isDefined(n.append)||(n.append=!0),isDefined(n.persistent)||(n.persistent=!0);var a=new Frame(ClientMessage,e,t,n);return this.frames.push(a),a},Manager.prototype.open=function(e,t){var n=this.getFrame(e);return n?(this.focus&&this.focus!==n&&this.closeFrame(this.focus),this.focus=n,t&&mergeOptions(this.focus.options,t),this.openFrame(this.focus),this.opened.dispatch(n),n):void console.error("Manager open() there is no frame with that name",e)},Manager.prototype.openAbove=function(e,t){t=t||{},t.style=t.style||{};var n=this.getFrame(e);return n?(t.style.zIndex||(t.style.zIndex=n.style.zIndex+1),this.openFrame(n,t),n):void console.error("Manager open() there is no frame with that name",e)},Manager.prototype.close=function(e){var t=this.getFrame(e);return t?(this.closeFrame(t),this.focus=null,void this.closed.dispatch(t)):void console.warn("Manager close() there is no frame with that name",e)},Manager.prototype.handleMessage=function(e){var t=filterByKeyValue(this.handlers,"type",e.type);t&&t.callback.apply(this,[e.data])},Manager.prototype.openFrame=function(e,t){if(t&&mergeOptions(e.options,t),e.options.persistent)this.setPersistentFrame(e);else if(e.frameElement)console.warn("Manager",this.name,"already has",e.name,"open");else if(this.createFrameElement(e),e.options.append){var n=this.container;e.options.parent&&(n=e.options.parent),prependElement(n,e.frameElement)}},Manager.prototype.closeFrame=function(e){if(e.options.persistent&&null!==this.persistentFrame)this.persistentFrame.src="about:blank",this.persistentFrame.style.visibility="hidden";else if(e.frameElement){{e.frameElement.contentWindow}console.log("frame options",e.options),closeFrameWindow(e)}else console.warn("Manager",this.name,"frame",e.name,"is not open to close")},Manager.prototype.getFrame=function(e){var t;return"string"==typeof e?t=this.getFrameByName(e):Object.getOwnPropertyNames(e).name&&(t=this.frames.indexOf(e)),t},Manager.prototype.getFrameByName=function(e){var t,n=this.frames.filter(function(t){return t.name===e});return n.length>0&&(t=n[0]),t},Manager.prototype.setPersistentFrame=function(e){null===this.persistentFrame&&(this.persistentFrame=document.createElement("iframe"),prependElement(this.container,this.persistentFrame));var t=e.src,n=e.options;n.arguments=n.arguments||{},n.style=n.style||{},n.attributes=n.attributes||{};var s=createUrlArgs(n.arguments),a="&name="+e.name+"&"+s,r="?origin="+encodeURIComponent(document.location.href);setElementStyles(this.persistentFrame,n.style),setElementAttributes(this.persistentFrame,n.attributes),this.persistentFrame.id=e.name,this.persistentFrame.src=t+r+a,this.persistentFrame.style.visibility="visible",this.persistentFrame.sandbox="allow-forms allow-scripts allow-same-origin",e.frameElement=this.persistentFrame},Manager.prototype.createFrameElement=function(e){var t=e.src,n=e.options;n.arguments=n.arguments||{},n.style=n.style||{},n.attributes=n.attributes||{};var s=createUrlArgs(n.arguments),a="&name="+e.name+"&"+s,r="?origin="+encodeURIComponent(document.location.href),i=document.createElement("iframe");return setElementStyles(i,n.style),setElementAttributes(i,n.attributes),i.id=e.name,i.src=t+r+a,i.sandbox="allow-forms allow-scripts allow-same-origin",e.frameElement=i,e},Manager.prototype.createFrameContainer=function(e){var t;return elementExistsByClassName(e)||(t=window.document.createElement("div"),t.className=e,t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.zIndex=this.zIndex,prependElement(window.document.body,t)),t};
function Client(){this.handlers=[],this.params=parseParams();var e=filterByKeyValue(this.params,"name","name",!0),t=filterByKeyValue(this.params,"name","origin");return isDefined(e)&&isDefined(t)?(this.name=e.data,this.origin=t.data,void this.listen()):void console.info("A Framer Client will not work without the correct origin and name url args, origin and name")}Client.prototype.receiveMessage=function(e){e&&e.origin&&e.origin!==window.top.document.location.origin||e.data.messenger!==ManagerMessage||e.data.target!==this.name&&"undefined"!=typeof e.data.target||this.handleMessage(e.data)},Client.prototype.destroy=function(){this.unListen()},Client.prototype.listen=function(){this.listener=function(e){this.receiveMessage(e)}.bind(this),window.top.addEventListener("message",this.listener,!1)},Client.prototype.unListen=function(){window.top.removeEventListener("message",this.listener),this.listener=void 0},Client.prototype.handleMessage=function(e){var t=filterByKeyValue(this.handlers,"type",e.type);t&&t.callback.apply(this,[e.data])},Client.prototype.send=function(e,t,i){var n=new FrameMessage(e,t,this.name,i,ClientMessage);window.top.postMessage(n,this.origin)},Client.prototype.on=function(e,t){filterByKeyValue(this.handlers,"type",e)?console.error("You already have a callback for type",name):this.handlers.push({type:e,callback:t})};
function angularCloseFrameWindow(e){function n(){var n=a.get("$rootScope");n.$broadcast("$destroy"),setTimeout(function(){closeFrameWindow(e)},0)}var o=e.frameElement.contentWindow,t=o.angular.element(o.document.getElementById(e.options.angularAppId));console.log("ngApp",t);var a=o.angular.element(t).injector();n()}
})(window);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZyYW1lci5qcyIsInV0aWwuanMiLCJNYW5hZ2VyLmpzIiwiQ2xpZW50LmpzIiwiYW5ndWxhci1mcmFtZS5qcyJdLCJuYW1lcyI6WyJGcmFtZSIsInR5cGUiLCJuYW1lIiwic3JjIiwib3B0aW9ucyIsInRoaXMiLCJmcmFtZUVsZW1lbnQiLCJ1bmRlZmluZWQiLCJGcmFtZU1lc3NhZ2UiLCJkYXRhIiwib3JpZ2luIiwidGFyZ2V0IiwibWVzc2VuZ2VyIiwid2luZG93IiwiZnJhbWVyIiwibWFuYWdlcnMiLCJNYW5hZ2VyIiwiQ2xpZW50IiwiZG9tTG9nIiwiQ2xpZW50TWVzc2FnZSIsIk1hbmFnZXJNZXNzYWdlIiwiY2xvc2VGcmFtZVdpbmRvdyIsImZyYW1lIiwic2V0VGltZW91dCIsImV4IiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiY3JlYXRlVXJsQXJncyIsImFyZ3MiLCJhcmdzTGlzdCIsInByb3BlcnRpZXMiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwiZm9yRWFjaCIsImVuY29kZWRBcmciLCJlbmNvZGVVUkkiLCJwdXNoIiwiam9pbiIsIm1lcmdlT3B0aW9ucyIsImV4aXN0aW5nIiwiY3VzdG9tIiwia2V5cyIsImtleSIsImZpbHRlckJ5S2V5VmFsdWUiLCJjb2xsZWN0aW9uIiwidmFsdWUiLCJsYXN0IiwibmVlZGxlIiwicmVzdWx0IiwiZmlsdGVyIiwiaXRlbSIsImxlbmd0aCIsInJlc3VsdEluZGV4IiwicGFyc2VQYXJhbXMiLCJoYXNoIiwicmVzb2x2ZUhhc2hTZWFyY2giLCJwYXJhbWV0ZXJzIiwic2VnbWVudHMiLCJwYXJzZVVyaXMiLCJkb2N1bWVudCIsImxvY2F0aW9uIiwic2VhcmNoIiwic3RyaXBwZWRIYXNoIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsInRyeURlY29kZVVSSUNvbXBvbmVudCIsImRlY29kZVVSSUNvbXBvbmVudCIsImVycm9yIiwiY29uc29sZSIsImtleVZhbHVlIiwicmVwbGFjZSIsInNlZ21lbnRSZXN1bHRzIiwic3BsaXQiLCJpIiwia1ZhbHVlIiwiaXNEZWZpbmVkIiwidmFsIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaXNBcnJheSIsInByZXBlbmRFbGVtZW50IiwicGFyZW50RWxlbWVudCIsImVsZW1lbnQiLCJpbnNlcnRCZWZvcmUiLCJmaXJzdENoaWxkIiwic2V0RWxlbWVudFN0eWxlcyIsInN0eWxlcyIsInN0eWxlIiwic2V0RWxlbWVudEF0dHJpYnV0ZXMiLCJhdHRyaWJ1dGVzIiwiYXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwiZWxlbWVudEV4aXN0c0J5Q2xhc3NOYW1lIiwiY2xhc3NOYW1lIiwiZXhpc3RpbmdFbGVtZW50cyIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJtZXNzYWdlIiwiY29sb3IiLCJjb250YWluZXIiLCJjcmVhdGVFbGVtZW50IiwicG9zaXRpb24iLCJ0b3AiLCJyaWdodCIsImJvZHkiLCJsb2dNZXNzYWdlIiwiaW5uZXJUZXh0IiwiZm9udFNpemUiLCJhcHBlbmRDaGlsZCIsImZyYW1lcyIsImhhbmRsZXJzIiwiZm9jdXMiLCJwZXJzaXN0ZW50RnJhbWUiLCJ6SW5kZXgiLCJjcmVhdGVGcmFtZUNvbnRhaW5lciIsImxlZnQiLCJib3R0b20iLCJ3aWR0aCIsImhlaWdodCIsImJvcmRlciIsIm1hcmdpbiIsInBhZGRpbmciLCJvdmVyZmxvdyIsImxpc3RlbiIsIlNpZ25hbCIsInNpZ25hbHMiLCJjbG9zZWQiLCJvcGVuZWQiLCJwcm90b3R5cGUiLCJyZWNlaXZlTWVzc2FnZSIsImV2ZW50IiwiaGFuZGxlTWVzc2FnZSIsImRlc3Ryb3kiLCJ1bkxpc3RlbiIsImxpc3RlbmVyIiwiYmluZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2VuZCIsInBvc3RNZXNzYWdlIiwib24iLCJjYWxsYmFjayIsImFkZCIsIndhcm4iLCJhcHBlbmQiLCJwZXJzaXN0ZW50Iiwib3BlbiIsImdldEZyYW1lIiwiY2xvc2VGcmFtZSIsIm9wZW5GcmFtZSIsImRpc3BhdGNoIiwib3BlbkFib3ZlIiwiY2xvc2UiLCJhcHBseSIsInNldFBlcnNpc3RlbnRGcmFtZSIsImNyZWF0ZUZyYW1lRWxlbWVudCIsInBhcmVudCIsInZpc2liaWxpdHkiLCJjb250ZW50V2luZG93IiwibG9nIiwiZXhpc3RpbmdGcmFtZSIsImdldEZyYW1lQnlOYW1lIiwiYXJndW1lbnRzIiwicGFyYW1zIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiaHJlZiIsImlkIiwic2FuZGJveCIsImlmcmFtZSIsImluZm8iLCJhbmd1bGFyQ2xvc2VGcmFtZVdpbmRvdyIsImRlc3Ryb3lBbGxTY29wZXMiLCJyb290U2NvcGUiLCJpbmplY3RvciIsImdldCIsIiRicm9hZGNhc3QiLCJjaGlsZFdpbmRvdyIsIm5nQXBwIiwiYW5ndWxhciIsImdldEVsZW1lbnRCeUlkIiwiYW5ndWxhckFwcElkIl0sIm1hcHBpbmdzIjoiQUFVQSxRQUFTQSxPQUFNQyxFQUFNQyxFQUFNQyxFQUFLQyxHQUM1QkMsS0FBS0osS0FBT0EsRUFDWkksS0FBS0gsS0FBT0EsRUFDWkcsS0FBS0YsSUFBTUEsRUFDWEUsS0FBS0QsUUFBVUEsRUFDZkMsS0FBS0MsYUFBZUMsT0FHeEIsUUFBU0MsY0FBYVAsRUFBTVEsRUFBTUMsRUFBUUMsRUFBUUMsR0FDOUNQLEtBQUtKLEtBQU9BLEVBQ1pJLEtBQUtJLEtBQU9BLEVBQ1pKLEtBQUtLLE9BQVNBLEVBQ2RMLEtBQUtNLE9BQVNBLEVBQ2ROLEtBQUtPLFVBQVlBLEVBdkJyQkMsT0FBT0MsUUFDSEMsWUFDQUMsUUFBU0EsUUFDVEMsT0FBUUEsT0FDUkMsT0FBUUEsT0FHWixJQUFJQyxlQUFnQixTQUNoQkMsZUFBaUI7QUNSckIsUUFBU0Msa0JBQWlCQyxHQUN0QkMsV0FBVyxXQUNQLElBQ0lELEVBQU1oQixhQUFhSCxJQUFNLGNBRTdCLE1BQU9xQixJQUdQRCxXQUFXLFdBQ1BELEVBQU1oQixhQUFhbUIsV0FBV0MsWUFBWUosRUFBTWhCLGNBQ2hEZ0IsRUFBTWhCLGFBQWVD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NUcsR0FNekNtRSxRQUFRRCxNQUFNLHVDQUF3Q2pFLE1BTHRERyxLQUFLd0csU0FBU3pFLE1BQ1ZuQyxLQUFNQSxFQUNOMkksU0FBVUE7QUMvRHRCLFFBQVM2Qix5QkFBd0JuSixHQVE3QixRQUFTb0osS0FDTCxHQUFJQyxHQUFZQyxFQUFTQyxJQUFJLGFBQzdCRixHQUFVRyxXQUFXLFlBQ3JCdkosV0FBVyxXQUNQRixpQkFBaUJDLElBQ2xCLEdBWlAsR0FBSXlKLEdBQWN6SixFQUFNaEIsYUFBYXVKLGNBQ2pDbUIsRUFBUUQsRUFBWUUsUUFBUS9GLFFBQVE2RixFQUFZcEgsU0FBU3VILGVBQWU1SixFQUFNbEIsUUFBUStLLGNBQzFGL0csU0FBUTBGLElBQUksUUFBU2tCLEVBRXJCLElBQUlKLEdBQVdHLEVBQVlFLFFBQVEvRixRQUFROEYsR0FBT0osVUFDbERGIiwiZmlsZSI6ImZyYW1lci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ3aW5kb3cuZnJhbWVyID0ge1xyXG4gICAgbWFuYWdlcnM6IFtdLFxyXG4gICAgTWFuYWdlcjogTWFuYWdlcixcclxuICAgIENsaWVudDogQ2xpZW50LFxyXG4gICAgZG9tTG9nOiBkb21Mb2dcclxufTtcclxuXHJcbnZhciBDbGllbnRNZXNzYWdlID0gJ2NsaWVudCc7XHJcbnZhciBNYW5hZ2VyTWVzc2FnZSA9ICdtYW5hZ2VyJztcclxuXHJcbmZ1bmN0aW9uIEZyYW1lKHR5cGUsIG5hbWUsIHNyYywgb3B0aW9ucykge1xyXG4gICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLnNyYyA9IHNyYztcclxuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICB0aGlzLmZyYW1lRWxlbWVudCA9IHVuZGVmaW5lZDtcclxufVxyXG5cclxuZnVuY3Rpb24gRnJhbWVNZXNzYWdlKHR5cGUsIGRhdGEsIG9yaWdpbiwgdGFyZ2V0LCBtZXNzZW5nZXIpIHtcclxuICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgdGhpcy5vcmlnaW4gPSBvcmlnaW47XHJcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcclxuICAgIHRoaXMubWVzc2VuZ2VyID0gbWVzc2VuZ2VyO1xyXG59IiwiZnVuY3Rpb24gY2xvc2VGcmFtZVdpbmRvdyhmcmFtZSkge1xyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgZnJhbWUuZnJhbWVFbGVtZW50LnNyYyA9ICdhYm91dDpibGFuayc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAvLyBEbyBub3RoaW5nXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBmcmFtZS5mcmFtZUVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChmcmFtZS5mcmFtZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICBmcmFtZS5mcmFtZUVsZW1lbnQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfSwgMTAwKTtcclxuICAgIH0sIDApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVVcmxBcmdzKGFyZ3MpIHtcclxuICAgIHZhciBhcmdzTGlzdCA9IFtdO1xyXG4gICAgdmFyIHByb3BlcnRpZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhhcmdzKTtcclxuXHJcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gcHJvcGVydHlSZXNvbHZlcihuYW1lKSB7XHJcbiAgICAgICAgdmFyIGVuY29kZWRBcmcgPSBuYW1lICsgJz0nICsgZW5jb2RlVVJJKGFyZ3NbbmFtZV0pO1xyXG4gICAgICAgIGFyZ3NMaXN0LnB1c2goZW5jb2RlZEFyZyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gYXJnc0xpc3Quam9pbignJicpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtZXJnZU9wdGlvbnMoZXhpc3RpbmcsIGN1c3RvbSkge1xyXG4gICAgdmFyIGtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhjdXN0b20pO1xyXG4gICAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGV4aXN0aW5nW2tleV0gPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGV4aXN0aW5nW2tleV0gPSBjdXN0b21ba2V5XTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZmlsdGVyQnlLZXlWYWx1ZShjb2xsZWN0aW9uLCBrZXksIHZhbHVlLCBsYXN0KSB7XHJcbiAgICB2YXIgbmVlZGxlO1xyXG4gICAgdmFyIHJlc3VsdCA9IGNvbGxlY3Rpb24uZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW1ba2V5XSA9PT0gdmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICB2YXIgcmVzdWx0SW5kZXggPSAwO1xyXG4gICAgICAgIGlmIChsYXN0KSB7XHJcbiAgICAgICAgICAgIHJlc3VsdEluZGV4ID0gcmVzdWx0Lmxlbmd0aCAtIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5lZWRsZSA9IHJlc3VsdFtyZXN1bHRJbmRleF07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmVlZGxlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwYXJzZVBhcmFtcyhoYXNoKSB7XHJcbiAgICBoYXNoID0gaGFzaCB8fCByZXNvbHZlSGFzaFNlYXJjaCgpO1xyXG4gICAgdmFyIHBhcmFtZXRlcnMgPSBbXTtcclxuXHJcbiAgICB2YXIgc2VnbWVudHMgPSBwYXJzZVVyaXMoaGFzaCk7XHJcbiAgICBmb3IgKHZhciBuYW1lIGluIHNlZ21lbnRzKSB7XHJcbiAgICAgICAgcGFyYW1ldGVycy5wdXNoKHtcclxuICAgICAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICAgICAgZGF0YTogc2VnbWVudHNbbmFtZV1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcGFyYW1ldGVycztcclxufVxyXG5cclxuZnVuY3Rpb24gcmVzb2x2ZUhhc2hTZWFyY2goKSB7XHJcbiAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoICE9PSAnJykge1xyXG4gICAgICAgIHJldHVybiBkb2N1bWVudC5sb2NhdGlvbi5zZWFyY2g7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZhciBoYXNoID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaDtcclxuICAgICAgICB2YXIgc3RyaXBwZWRIYXNoID0gaGFzaC5zdWJzdHJpbmcoaGFzaC5pbmRleE9mKCc/JykgKyAxLCBoYXNoLmxlbmd0aCk7XHJcbiAgICAgICAgcmV0dXJuIHN0cmlwcGVkSGFzaDtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gdHJ5RGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdUaGVyZSB3YXMgYW4gaXNzdWUgcGFyc2luZyB0aGUgdXJpIHNlZ21lbnQsIGNoZWNrIHlvdXIgaWZyYW1lIHNyYycsIGVycm9yKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VVcmlzKGtleVZhbHVlKSB7XHJcbiAgICBrZXlWYWx1ZSA9IGtleVZhbHVlLnJlcGxhY2UoL15cXD8vLCAnJyk7XHJcbiAgICB2YXIgc2VnbWVudFJlc3VsdHMgPSB7fSwgdmFsdWUsIGtleTtcclxuICAgIHZhciBzZWdtZW50cyA9IChrZXlWYWx1ZSB8fCBcIlwiKS5zcGxpdCgnJicpO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWdtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHZhciBrVmFsdWUgPSBzZWdtZW50c1tpXTtcclxuICAgICAgICBpZiAoa1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0ga1ZhbHVlLnJlcGxhY2UoL1xcKy9nLCAnJTIwJykuc3BsaXQoJz0nKTtcclxuICAgICAgICAgICAga2V5ID0gdHJ5RGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlWzBdKTtcclxuICAgICAgICAgICAgaWYgKGlzRGVmaW5lZChrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gaXNEZWZpbmVkKHZhbHVlWzFdKSA/IHRyeURlY29kZVVSSUNvbXBvbmVudCh2YWx1ZVsxXSkgOiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wZXJ0eS5jYWxsKHNlZ21lbnRSZXN1bHRzLCBrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VnbWVudFJlc3VsdHNba2V5XSA9IHZhbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBcnJheShzZWdtZW50UmVzdWx0c1trZXldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlZ21lbnRSZXN1bHRzW2tleV0ucHVzaCh2YWwpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWdtZW50UmVzdWx0c1trZXldID0gW3NlZ21lbnRSZXN1bHRzW2tleV0sIHZhbF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2VnbWVudFJlc3VsdHM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByZXBlbmRFbGVtZW50KHBhcmVudEVsZW1lbnQsIGVsZW1lbnQpIHtcclxuICAgIHJldHVybiBwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShlbGVtZW50LCBwYXJlbnRFbGVtZW50LmZpcnN0Q2hpbGQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFbGVtZW50U3R5bGVzKGVsZW1lbnQsIHN0eWxlcykge1xyXG4gICAgZm9yICh2YXIgc3R5bGUgaW4gc3R5bGVzKSB7XHJcbiAgICAgICAgZWxlbWVudC5zdHlsZVtzdHlsZV0gPSBzdHlsZXNbc3R5bGVdO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFbGVtZW50QXR0cmlidXRlcyhlbGVtZW50LCBhdHRyaWJ1dGVzKSB7XHJcbiAgICBmb3IgKHZhciBhdHRyaWJ1dGUgaW4gYXR0cmlidXRlcykge1xyXG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgYXR0cmlidXRlc1thdHRyaWJ1dGVdKTtcclxuICAgIH1cclxuICAgIHJldHVybiBlbGVtZW50O1xyXG59XHJcblxyXG5mdW5jdGlvbiBlbGVtZW50RXhpc3RzQnlDbGFzc05hbWUoY2xhc3NOYW1lKSB7XHJcbiAgICB2YXIgZXhpc3RpbmdFbGVtZW50cyA9IHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7XHJcbiAgICByZXR1cm4gZXhpc3RpbmdFbGVtZW50cy5sZW5ndGggPiAwO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0RlZmluZWQodmFsdWUpIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnO1xyXG59XHJcblxyXG4vKipcclxuICogU2ltcGxlIHV0aWxpdHkgdG8gbG9nIG1lc3NhZ2VzIHRvIHRoZSBkb20uXHJcbiAqIEBwYXJhbSBtZXNzYWdlXHJcbiAqIEBwYXJhbSBjb2xvclxyXG4gKi9cclxuZnVuY3Rpb24gZG9tTG9nKG1lc3NhZ2UsIGNvbG9yKSB7XHJcbiAgICB2YXIgY2xhc3NOYW1lID0gJ2RvbS1sb2cnO1xyXG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKVswXTtcclxuICAgIGlmICghY29udGFpbmVyKSB7XHJcbiAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS50b3AgPSAnMCc7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLnJpZ2h0ID0gJzAnO1xyXG4gICAgICAgIHByZXBlbmRFbGVtZW50KHdpbmRvdy5kb2N1bWVudC5ib2R5LCBjb250YWluZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBsb2dNZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgbG9nTWVzc2FnZS5pbm5lclRleHQgPSBtZXNzYWdlO1xyXG4gICAgbG9nTWVzc2FnZS5zdHlsZS5jb2xvciA9IGNvbG9yO1xyXG4gICAgbG9nTWVzc2FnZS5zdHlsZS5mb250U2l6ZSA9ICcwLjVlbSc7XHJcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobG9nTWVzc2FnZSk7XHJcbn0iLCJcclxuLyoqXHJcbiAqIE1hbmFnZXIgaXMgdGhlIG1hbmFnZXIgb2YgYSBzZXQgb2YgaWZyYW1lL3dlYnZpZXcgZWxlbWVudHNcclxuICogdGhhdCBjYW4gY29tbXVuaWNhdGUgd2l0aCBzZW5kIGFuZCByZWNlaXZlLlxyXG4gKlxyXG4gKiBAcGFyYW0gbmFtZVxyXG4gKiBAY29uc3RydWN0b3JcclxuICovXHJcbmZ1bmN0aW9uIE1hbmFnZXIobmFtZSwgb3B0aW9ucykge1xyXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgIHRoaXMuZnJhbWVzID0gW107XHJcbiAgICB0aGlzLmhhbmRsZXJzID0gW107XHJcbiAgICB0aGlzLmZvY3VzID0gbnVsbDtcclxuICAgIHRoaXMucGVyc2lzdGVudEZyYW1lID0gbnVsbDtcclxuICAgIHRoaXMuekluZGV4ID0gOTk5OTk7XHJcbiAgICBpZihvcHRpb25zICYmIG9wdGlvbnMuY29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgKz0gKCcgJyArIHRoaXMubmFtZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5jcmVhdGVGcmFtZUNvbnRhaW5lcih0aGlzLm5hbWUpO1xyXG4gICAgfVxyXG4gICAgLy8gVGhlIGRlZmF1bHQgc3R5bGUgd2lsbCBtYWtlIHRoZSBmcmFtZXMgZnVsbHNjcmVlbiBhcyBpZiB0aGlzIGlzIGFcclxuICAgIC8vIHNpbmdsZSBmcmFtZSBhcHBsaWNhdGlvbiA7KVxyXG4gICAgdGhpcy5zdHlsZSA9IHtcclxuICAgICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcclxuICAgICAgICB0b3A6ICcwcHgnLFxyXG4gICAgICAgIGxlZnQ6ICcwcHgnLFxyXG4gICAgICAgIGJvdHRvbTogJzBweCcsXHJcbiAgICAgICAgcmlnaHQ6ICcwcHgnLFxyXG4gICAgICAgIHdpZHRoOiAnMTAwJScsXHJcbiAgICAgICAgaGVpZ2h0OiAnMTAwJScsXHJcbiAgICAgICAgYm9yZGVyOiAnbm9uZScsXHJcbiAgICAgICAgbWFyZ2luOiAnMCcsXHJcbiAgICAgICAgcGFkZGluZzogJzAnLFxyXG4gICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJ1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmxpc3RlbigpO1xyXG5cclxuICAgIHZhciBTaWduYWwgPSBzaWduYWxzLlNpZ25hbDtcclxuICAgIHRoaXMuY2xvc2VkID0gbmV3IFNpZ25hbCgpO1xyXG4gICAgdGhpcy5vcGVuZWQgPSBuZXcgU2lnbmFsKCk7XHJcblxyXG4gICAgd2luZG93LmZyYW1lci5tYW5hZ2Vycy5wdXNoKHRoaXMpO1xyXG59XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5yZWNlaXZlTWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgaWYgKGV2ZW50Lm9yaWdpbiAhPT0gZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChldmVudC5kYXRhLm1lc3NlbmdlciA9PT0gQ2xpZW50TWVzc2FnZSAmJlxyXG4gICAgICAgIChldmVudC5kYXRhLnRhcmdldCA9PT0gdGhpcy5uYW1lIHx8IHR5cGVvZiBldmVudC5kYXRhLnRhcmdldCA9PT0gJ3VuZGVmaW5lZCcpKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVNZXNzYWdlKGV2ZW50LmRhdGEpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuTWFuYWdlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy51bkxpc3RlbigpO1xyXG59O1xyXG5cclxuTWFuYWdlci5wcm90b3R5cGUubGlzdGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLmxpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgICAgIHRoaXMucmVjZWl2ZU1lc3NhZ2UoZXZlbnQpO1xyXG4gICAgfS5iaW5kKHRoaXMpO1xyXG5cclxuICAgIHdpbmRvdy50b3AuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMubGlzdGVuZXIsIGZhbHNlKTtcclxufTtcclxuXHJcbk1hbmFnZXIucHJvdG90eXBlLnVuTGlzdGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICB3aW5kb3cudG9wLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmxpc3RlbmVyKTtcclxuICAgIHRoaXMubGlzdGVuZXIgPSB1bmRlZmluZWQ7XHJcbn07XHJcblxyXG4vKipcclxuICogU2VuZCBhIG1lc3NhZ2UgdG8gYSBDbGllbnQsIGlmIG5vIHRhcmdldCBpcyBzcGVjaWZpZWQgc2VuZCB0byBhbGwuXHJcbiAqIEBwYXJhbSB0eXBlIHRoZSBtZXNzYWdlIHR5cGUgdG8gdXNlIGJhc2VkIHRoYXQgZGVzY3JpYmVzIHRoZSBmZWF0dXJlLCBlZyBzdWJtaXQsIHNlbmQsIGxvZ291dFxyXG4gKiBAcGFyYW0gZGF0YSB0aGUgb2F0XHJcbiAqIEBwYXJhbSB0YXJnZXRcclxuICovXHJcbk1hbmFnZXIucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAodHlwZSwgZGF0YSwgdGFyZ2V0KSB7XHJcbiAgICB2YXIgbWVzc2FnZSA9IG5ldyBGcmFtZU1lc3NhZ2UodHlwZSwgZGF0YSwgdGhpcy5uYW1lLCB0YXJnZXQsIE1hbmFnZXJNZXNzYWdlKTtcclxuICAgIHdpbmRvdy50b3AucG9zdE1lc3NhZ2UobWVzc2FnZSwgZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZWNlaXZlIGEgbWVzc2FnZSBvbiBhIE1hbmFnZXIgaW5zdGFuY2UuIFRoZSBjYWxsYmFjayB3aWxsIHJlY2lldmUgdGhlIGRhdGFcclxuICogdmFsdWUgc2VudCB3aXRoIE1hbmFnZXIucHJvdG90eXBlLnNlbmQoKVxyXG4gKiBAcGFyYW0gdHlwZVxyXG4gKiBAcGFyYW0gY2FsbGJhY2tcclxuICovXHJcbk1hbmFnZXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKHR5cGUsIGNhbGxiYWNrKSB7XHJcbiAgICBpZiAoIWZpbHRlckJ5S2V5VmFsdWUodGhpcy5oYW5kbGVycywgJ3R5cGUnLCB0eXBlKSkge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaCh7XHJcbiAgICAgICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdZb3UgYWxyZWFkeSBoYXZlIGEgY2FsbGJhY2sgZm9yIHR5cGUnLCB0eXBlKTtcclxuICAgIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZGQgYSBuZXcgZnJhbWUgdG8gdGhlIE1hbmFnZXIgaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lIHRoZSB1bmlxdWUgbmFtZSB0byBtYW5hZ2UgYW5kIHJlY2lldmUgbWVzc2FnZXNcclxuICogQHBhcmFtIHNyYyB0aGUgc3JjIHVybCB0aGF0IGlzIGdpdmVuIHRvIHRoZSBpZnJhbWUvd2Vidmlld1xyXG4gKiBAcGFyYW0gb3B0aW9ucyBhbiBvYmplY3Qgd2l0aCB2YWx1ZXMgZm9yIHN0eWxlLCBhdHRyaWJ1dGVzIGFuZCB1cmwgYXJndW1lbnRzIGZvciB0aGUgc3JjXHJcbiAqIEByZXR1cm5zIHsqfVxyXG4gKi9cclxuTWFuYWdlci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKG5hbWUsIHNyYywgb3B0aW9ucykge1xyXG4gICAgdmFyIGV4aXN0aW5nID0gZmlsdGVyQnlLZXlWYWx1ZSh0aGlzLmZyYW1lcywgJ25hbWUnLCBuYW1lKTtcclxuICAgIGlmIChleGlzdGluZykge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignTWFuYWdlci5hZGQoKSB0aGVyZSBpcyBhbHJlYWR5IGEgZnJhbWUgbmFtZWQnLFxyXG4gICAgICAgICAgICBuYW1lLCAnaW4gdGhlIGZyYW1lcicsIHRoaXMubmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nO1xyXG4gICAgfVxyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgaWYgKCFpc0RlZmluZWQob3B0aW9ucy5zdHlsZSkpIHtcclxuICAgICAgICBvcHRpb25zLnN0eWxlID0gdGhpcy5zdHlsZTtcclxuICAgIH1cclxuICAgIGlmICghaXNEZWZpbmVkKG9wdGlvbnMuYXBwZW5kKSkge1xyXG4gICAgICAgIG9wdGlvbnMuYXBwZW5kID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIGlmICghaXNEZWZpbmVkKG9wdGlvbnMucGVyc2lzdGVudCkpIHtcclxuICAgICAgICBvcHRpb25zLnBlcnNpc3RlbnQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBmcmFtZSA9IG5ldyBGcmFtZShDbGllbnRNZXNzYWdlLCBuYW1lLCBzcmMsIG9wdGlvbnMpO1xyXG4gICAgdGhpcy5mcmFtZXMucHVzaChmcmFtZSk7XHJcblxyXG4gICAgcmV0dXJuIGZyYW1lO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIE9wZW4gYSBmcmFtZSBieSBuYW1lIGFuZCBjbG9zZSBhbnkgb3BlbmVkIGZyYW1lcy5cclxuICpcclxuICogQHBhcmFtIG5hbWVcclxuICogQHBhcmFtIG9wdGlvbnNcclxuICovXHJcbk1hbmFnZXIucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAobmFtZSwgb3B0aW9ucykge1xyXG4gICAgdmFyIGV4aXN0aW5nID0gdGhpcy5nZXRGcmFtZShuYW1lKTtcclxuICAgIGlmICghZXhpc3RpbmcpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdNYW5hZ2VyIG9wZW4oKSB0aGVyZSBpcyBubyBmcmFtZSB3aXRoIHRoYXQgbmFtZScsIG5hbWUpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmZvY3VzICYmIHRoaXMuZm9jdXMgIT09IGV4aXN0aW5nKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZUZyYW1lKHRoaXMuZm9jdXMpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5mb2N1cyA9IGV4aXN0aW5nO1xyXG5cclxuICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgbWVyZ2VPcHRpb25zKHRoaXMuZm9jdXMub3B0aW9ucywgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLm9wZW5GcmFtZSh0aGlzLmZvY3VzKTtcclxuXHJcbiAgICB0aGlzLm9wZW5lZC5kaXNwYXRjaChleGlzdGluZyk7XHJcblxyXG4gICAgcmV0dXJuIGV4aXN0aW5nO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIE9wZW4gYSBmcmFtZSBieSBuYW1lIGFuZCBpbnN0ZWFkIG9mIGNsb3NpbmcgYW55IG9wZW5lZCBmcmFtZXMsXHJcbiAqIHRoaXMgZnJhbWUgd2lsbCBpbnN0ZWFkIG9wZW4gYXQgYSB6SW5kZXggYWJvdmUgdGhlIGV4aXN0aW5nIG9wZW5lZCBmcmFtZS5cclxuICpcclxuICogQHBhcmFtIG5hbWVcclxuICogQHBhcmFtIG9wdGlvbnNcclxuICovXHJcbk1hbmFnZXIucHJvdG90eXBlLm9wZW5BYm92ZSA9IGZ1bmN0aW9uIChuYW1lLCBvcHRpb25zKSB7XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuICAgIG9wdGlvbnMuc3R5bGUgPSBvcHRpb25zLnN0eWxlIHx8IHt9O1xyXG5cclxuICAgIHZhciBleGlzdGluZyA9IHRoaXMuZ2V0RnJhbWUobmFtZSk7XHJcbiAgICBpZiAoIWV4aXN0aW5nKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignTWFuYWdlciBvcGVuKCkgdGhlcmUgaXMgbm8gZnJhbWUgd2l0aCB0aGF0IG5hbWUnLCBuYW1lKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIW9wdGlvbnMuc3R5bGUuekluZGV4KSB7XHJcbiAgICAgICAgb3B0aW9ucy5zdHlsZS56SW5kZXggPSBleGlzdGluZy5zdHlsZS56SW5kZXggKyAxO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vcGVuRnJhbWUoZXhpc3RpbmcsIG9wdGlvbnMpO1xyXG5cclxuICAgIHJldHVybiBleGlzdGluZztcclxufTtcclxuXHJcbk1hbmFnZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgIHZhciBleGlzdGluZyA9IHRoaXMuZ2V0RnJhbWUobmFtZSk7XHJcbiAgICBpZiAoIWV4aXN0aW5nKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCdNYW5hZ2VyIGNsb3NlKCkgdGhlcmUgaXMgbm8gZnJhbWUgd2l0aCB0aGF0IG5hbWUnLCBuYW1lKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmNsb3NlRnJhbWUoZXhpc3RpbmcpO1xyXG4gICAgdGhpcy5mb2N1cyA9IG51bGw7XHJcblxyXG4gICAgdGhpcy5jbG9zZWQuZGlzcGF0Y2goZXhpc3RpbmcpO1xyXG59O1xyXG5cclxuTWFuYWdlci5wcm90b3R5cGUuaGFuZGxlTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICB2YXIgcmVzdWx0ID0gZmlsdGVyQnlLZXlWYWx1ZSh0aGlzLmhhbmRsZXJzLCAndHlwZScsIG1lc3NhZ2UudHlwZSk7XHJcbiAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgcmVzdWx0LmNhbGxiYWNrLmFwcGx5KHRoaXMsIFttZXNzYWdlLmRhdGFdKTtcclxuICAgIH1cclxufTtcclxuXHJcbk1hbmFnZXIucHJvdG90eXBlLm9wZW5GcmFtZSA9IGZ1bmN0aW9uIChmcmFtZSwgb3B0aW9ucykge1xyXG4gICAgLy9tZXJnZSBleGlzdGluZyBvcHRpb25zIHdpdGggb3ZlcnJpZGVcclxuICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgbWVyZ2VPcHRpb25zKGZyYW1lLm9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKGZyYW1lLm9wdGlvbnMucGVyc2lzdGVudCkge1xyXG4gICAgICAgIHRoaXMuc2V0UGVyc2lzdGVudEZyYW1lKGZyYW1lKTtcclxuXHJcbiAgICB9IGVsc2UgaWYgKCFmcmFtZS5mcmFtZUVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmNyZWF0ZUZyYW1lRWxlbWVudChmcmFtZSk7XHJcbiAgICAgICAgaWYgKGZyYW1lLm9wdGlvbnMuYXBwZW5kKSB7XHJcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmNvbnRhaW5lcjtcclxuICAgICAgICAgICAgaWYgKGZyYW1lLm9wdGlvbnMucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnQgPSBmcmFtZS5vcHRpb25zLnBhcmVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwcmVwZW5kRWxlbWVudChwYXJlbnQsIGZyYW1lLmZyYW1lRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ01hbmFnZXInLCB0aGlzLm5hbWUsICdhbHJlYWR5IGhhcycsIGZyYW1lLm5hbWUsICdvcGVuJyk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5jbG9zZUZyYW1lID0gZnVuY3Rpb24gKGZyYW1lKSB7XHJcbiAgICBpZihmcmFtZS5vcHRpb25zLnBlcnNpc3RlbnQgJiYgdGhpcy5wZXJzaXN0ZW50RnJhbWUgIT09IG51bGwpIHtcclxuICAgICAgICB0aGlzLnBlcnNpc3RlbnRGcmFtZS5zcmMgPSAnYWJvdXQ6YmxhbmsnO1xyXG4gICAgICAgIHRoaXMucGVyc2lzdGVudEZyYW1lLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuXHJcbiAgICB9IGVsc2UgaWYoZnJhbWUuZnJhbWVFbGVtZW50KSB7XHJcbiAgICAgICAgdmFyIGNoaWxkV2luZG93ID0gZnJhbWUuZnJhbWVFbGVtZW50LmNvbnRlbnRXaW5kb3c7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2ZyYW1lIG9wdGlvbnMnLCBmcmFtZS5vcHRpb25zKTtcclxuICAgICAgICAvL2lmIChmcmFtZS5vcHRpb25zLmFuZ3VsYXJBcHBJZCAmJiBjaGlsZFdpbmRvdy5hbmd1bGFyKSB7XHJcbiAgICAgICAgLy8gICAgYW5ndWxhckNsb3NlRnJhbWVXaW5kb3coZnJhbWUpO1xyXG4gICAgICAgIC8vfVxyXG4gICAgICAgIC8vZWxzZSB7XHJcbiAgICAgICAgICAgIGNsb3NlRnJhbWVXaW5kb3coZnJhbWUpO1xyXG4gICAgICAgIC8vfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ01hbmFnZXInLCB0aGlzLm5hbWUsICdmcmFtZScsIGZyYW1lLm5hbWUsICdpcyBub3Qgb3BlbiB0byBjbG9zZScpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuTWFuYWdlci5wcm90b3R5cGUuZ2V0RnJhbWUgPSBmdW5jdGlvbiAoZnJhbWUpIHtcclxuICAgIHZhciBleGlzdGluZ0ZyYW1lO1xyXG4gICAgaWYgKHR5cGVvZiBmcmFtZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICBleGlzdGluZ0ZyYW1lID0gdGhpcy5nZXRGcmFtZUJ5TmFtZShmcmFtZSlcclxuICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZnJhbWUpLm5hbWUpIHtcclxuICAgICAgICBleGlzdGluZ0ZyYW1lID0gdGhpcy5mcmFtZXMuaW5kZXhPZihmcmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGV4aXN0aW5nRnJhbWU7XHJcbn07XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5nZXRGcmFtZUJ5TmFtZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICB2YXIgZnJhbWU7XHJcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5mcmFtZXMuZmlsdGVyKGZ1bmN0aW9uIChmcmFtZSkge1xyXG4gICAgICAgIHJldHVybiBmcmFtZS5uYW1lID09PSBuYW1lO1xyXG4gICAgfSk7XHJcbiAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICBmcmFtZSA9IHJlc3VsdFswXTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZnJhbWU7XHJcbn07XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5zZXRQZXJzaXN0ZW50RnJhbWUgPSBmdW5jdGlvbihmcmFtZSkge1xyXG4gICAgaWYodGhpcy5wZXJzaXN0ZW50RnJhbWUgPT09IG51bGwpIHtcclxuICAgICAgICB0aGlzLnBlcnNpc3RlbnRGcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xyXG4gICAgICAgIHByZXBlbmRFbGVtZW50KHRoaXMuY29udGFpbmVyLCB0aGlzLnBlcnNpc3RlbnRGcmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHNyYyA9IGZyYW1lLnNyYztcclxuICAgIHZhciBvcHRpb25zID0gZnJhbWUub3B0aW9ucztcclxuICAgIG9wdGlvbnMuYXJndW1lbnRzID0gb3B0aW9ucy5hcmd1bWVudHMgfHwge307XHJcbiAgICBvcHRpb25zLnN0eWxlID0gb3B0aW9ucy5zdHlsZSB8fCB7fTtcclxuICAgIG9wdGlvbnMuYXR0cmlidXRlcyA9IG9wdGlvbnMuYXR0cmlidXRlcyB8fCB7fTtcclxuICAgIHZhciBwYXJhbWV0ZXJzID0gY3JlYXRlVXJsQXJncyhvcHRpb25zLmFyZ3VtZW50cyk7XHJcbiAgICB2YXIgcGFyYW1zID0gJyZuYW1lPScgKyBmcmFtZS5uYW1lICsgJyYnICsgcGFyYW1ldGVycztcclxuICAgIHZhciBvcmlnaW4gPSAnP29yaWdpbj0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGRvY3VtZW50LmxvY2F0aW9uLmhyZWYpO1xyXG5cclxuICAgIHNldEVsZW1lbnRTdHlsZXModGhpcy5wZXJzaXN0ZW50RnJhbWUsIG9wdGlvbnMuc3R5bGUpO1xyXG4gICAgc2V0RWxlbWVudEF0dHJpYnV0ZXModGhpcy5wZXJzaXN0ZW50RnJhbWUsIG9wdGlvbnMuYXR0cmlidXRlcyk7XHJcblxyXG4gICAgdGhpcy5wZXJzaXN0ZW50RnJhbWUuaWQgPSBmcmFtZS5uYW1lO1xyXG4gICAgdGhpcy5wZXJzaXN0ZW50RnJhbWUuc3JjID0gc3JjICsgb3JpZ2luICsgcGFyYW1zO1xyXG4gICAgdGhpcy5wZXJzaXN0ZW50RnJhbWUuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcclxuICAgIHRoaXMucGVyc2lzdGVudEZyYW1lLnNhbmRib3ggPSAnYWxsb3ctZm9ybXMgYWxsb3ctc2NyaXB0cyBhbGxvdy1zYW1lLW9yaWdpbic7XHJcbiAgICBmcmFtZS5mcmFtZUVsZW1lbnQgPSB0aGlzLnBlcnNpc3RlbnRGcmFtZTtcclxuXHJcbn07XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5jcmVhdGVGcmFtZUVsZW1lbnQgPSBmdW5jdGlvbiAoZnJhbWUpIHtcclxuICAgIHZhciBzcmMgPSBmcmFtZS5zcmM7XHJcbiAgICB2YXIgb3B0aW9ucyA9IGZyYW1lLm9wdGlvbnM7XHJcbiAgICBvcHRpb25zLmFyZ3VtZW50cyA9IG9wdGlvbnMuYXJndW1lbnRzIHx8IHt9O1xyXG4gICAgb3B0aW9ucy5zdHlsZSA9IG9wdGlvbnMuc3R5bGUgfHwge307XHJcbiAgICBvcHRpb25zLmF0dHJpYnV0ZXMgPSBvcHRpb25zLmF0dHJpYnV0ZXMgfHwge307XHJcbiAgICB2YXIgcGFyYW1ldGVycyA9IGNyZWF0ZVVybEFyZ3Mob3B0aW9ucy5hcmd1bWVudHMpO1xyXG4gICAgdmFyIHBhcmFtcyA9ICcmbmFtZT0nICsgZnJhbWUubmFtZSArICcmJyArIHBhcmFtZXRlcnM7XHJcbiAgICB2YXIgb3JpZ2luID0gJz9vcmlnaW49JyArIGVuY29kZVVSSUNvbXBvbmVudChkb2N1bWVudC5sb2NhdGlvbi5ocmVmKTtcclxuXHJcbiAgICAvL3RvZG8gd2VidmlldyBtcy1hcHAtd2Vidmlld1xyXG4gICAgdmFyIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xyXG5cclxuICAgIHNldEVsZW1lbnRTdHlsZXMoaWZyYW1lLCBvcHRpb25zLnN0eWxlKTtcclxuICAgIHNldEVsZW1lbnRBdHRyaWJ1dGVzKGlmcmFtZSwgb3B0aW9ucy5hdHRyaWJ1dGVzKTtcclxuXHJcbiAgICBpZnJhbWUuaWQgPSBmcmFtZS5uYW1lO1xyXG4gICAgaWZyYW1lLnNyYyA9IHNyYyArIG9yaWdpbiArIHBhcmFtcztcclxuICAgIGlmcmFtZS5zYW5kYm94ID0gJ2FsbG93LWZvcm1zIGFsbG93LXNjcmlwdHMgYWxsb3ctc2FtZS1vcmlnaW4nO1xyXG4gICAgZnJhbWUuZnJhbWVFbGVtZW50ID0gaWZyYW1lO1xyXG5cclxuICAgIHJldHVybiBmcmFtZTtcclxufTtcclxuXHJcblxyXG5cclxuTWFuYWdlci5wcm90b3R5cGUuY3JlYXRlRnJhbWVDb250YWluZXIgPSBmdW5jdGlvbiAoY2xhc3NOYW1lKSB7XHJcbiAgICB2YXIgY29udGFpbmVyO1xyXG4gICAgaWYgKCFlbGVtZW50RXhpc3RzQnlDbGFzc05hbWUoY2xhc3NOYW1lKSkge1xyXG4gICAgICAgIGNvbnRhaW5lciA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gY2xhc3NOYW1lO1xyXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLnRvcCA9IDA7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmxlZnQgPSAwO1xyXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS56SW5kZXggPSB0aGlzLnpJbmRleDtcclxuICAgICAgICBwcmVwZW5kRWxlbWVudCh3aW5kb3cuZG9jdW1lbnQuYm9keSwgY29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIHJldHVybiBjb250YWluZXI7XHJcbn07IiwiZnVuY3Rpb24gQ2xpZW50KCkge1xyXG4gICAgdGhpcy5oYW5kbGVycyA9IFtdO1xyXG5cclxuICAgIHRoaXMucGFyYW1zID0gcGFyc2VQYXJhbXMoKTtcclxuICAgIHZhciBuYW1lID0gZmlsdGVyQnlLZXlWYWx1ZSh0aGlzLnBhcmFtcywgJ25hbWUnLCAnbmFtZScsIHRydWUpO1xyXG4gICAgdmFyIG9yaWdpbiA9IGZpbHRlckJ5S2V5VmFsdWUodGhpcy5wYXJhbXMsICduYW1lJywgJ29yaWdpbicpO1xyXG4gICAgaWYgKCFpc0RlZmluZWQobmFtZSkgfHwgIWlzRGVmaW5lZChvcmlnaW4pKSB7XHJcbiAgICAgICAgY29uc29sZS5pbmZvKCdBIEZyYW1lciBDbGllbnQgd2lsbCBub3Qgd29yayB3aXRob3V0IHRoZSBjb3JyZWN0IG9yaWdpbiBhbmQgbmFtZSB1cmwgYXJncywgb3JpZ2luIGFuZCBuYW1lJyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5uYW1lID0gbmFtZS5kYXRhO1xyXG4gICAgdGhpcy5vcmlnaW4gPSBvcmlnaW4uZGF0YTtcclxuXHJcbiAgICB0aGlzLmxpc3RlbigpO1xyXG59XHJcblxyXG5DbGllbnQucHJvdG90eXBlLnJlY2VpdmVNZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBpZiAoZXZlbnQgJiZcclxuICAgICAgICBldmVudC5vcmlnaW4gJiZcclxuICAgICAgICBldmVudC5vcmlnaW4gIT09IHdpbmRvdy50b3AuZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChldmVudC5kYXRhLm1lc3NlbmdlciA9PT0gTWFuYWdlck1lc3NhZ2UgJiZcclxuICAgICAgICAoZXZlbnQuZGF0YS50YXJnZXQgPT09IHRoaXMubmFtZSB8fFxyXG4gICAgICAgIHR5cGVvZiBldmVudC5kYXRhLnRhcmdldCA9PT0gJ3VuZGVmaW5lZCcpKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVNZXNzYWdlKGV2ZW50LmRhdGEpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuQ2xpZW50LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLnVuTGlzdGVuKCk7XHJcbn07XHJcblxyXG5DbGllbnQucHJvdG90eXBlLmxpc3RlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5saXN0ZW5lciA9IGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICB0aGlzLnJlY2VpdmVNZXNzYWdlKGV2ZW50KTtcclxuICAgIH0uYmluZCh0aGlzKTtcclxuXHJcbiAgICB3aW5kb3cudG9wLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmxpc3RlbmVyLCBmYWxzZSk7XHJcbn07XHJcblxyXG5DbGllbnQucHJvdG90eXBlLnVuTGlzdGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICB3aW5kb3cudG9wLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmxpc3RlbmVyKTtcclxuICAgIHRoaXMubGlzdGVuZXIgPSB1bmRlZmluZWQ7XHJcbn07XHJcblxyXG5DbGllbnQucHJvdG90eXBlLmhhbmRsZU1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgdmFyIHJlc3VsdCA9IGZpbHRlckJ5S2V5VmFsdWUodGhpcy5oYW5kbGVycywgJ3R5cGUnLCBtZXNzYWdlLnR5cGUpO1xyXG4gICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgIHJlc3VsdC5jYWxsYmFjay5hcHBseSh0aGlzLCBbbWVzc2FnZS5kYXRhXSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5DbGllbnQucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAodHlwZSwgZGF0YSwgdGFyZ2V0KSB7XHJcbiAgICB2YXIgbWVzc2FnZSA9IG5ldyBGcmFtZU1lc3NhZ2UodHlwZSwgZGF0YSwgdGhpcy5uYW1lLCB0YXJnZXQsIENsaWVudE1lc3NhZ2UpO1xyXG4gICAgd2luZG93LnRvcC5wb3N0TWVzc2FnZShtZXNzYWdlLCB0aGlzLm9yaWdpbik7XHJcbn07XHJcblxyXG5DbGllbnQucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKHR5cGUsIGNhbGxiYWNrKSB7XHJcbiAgICBpZiAoIWZpbHRlckJ5S2V5VmFsdWUodGhpcy5oYW5kbGVycywgJ3R5cGUnLCB0eXBlKSkge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaCh7XHJcbiAgICAgICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdZb3UgYWxyZWFkeSBoYXZlIGEgY2FsbGJhY2sgZm9yIHR5cGUnLCBuYW1lKTtcclxuICAgIH1cclxufTsiLCJmdW5jdGlvbiBhbmd1bGFyQ2xvc2VGcmFtZVdpbmRvdyhmcmFtZSkge1xyXG4gICAgdmFyIGNoaWxkV2luZG93ID0gZnJhbWUuZnJhbWVFbGVtZW50LmNvbnRlbnRXaW5kb3c7XHJcbiAgICB2YXIgbmdBcHAgPSBjaGlsZFdpbmRvdy5hbmd1bGFyLmVsZW1lbnQoY2hpbGRXaW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZnJhbWUub3B0aW9ucy5hbmd1bGFyQXBwSWQpKTtcclxuICAgIGNvbnNvbGUubG9nKCduZ0FwcCcsIG5nQXBwKTtcclxuXHJcbiAgICB2YXIgaW5qZWN0b3IgPSBjaGlsZFdpbmRvdy5hbmd1bGFyLmVsZW1lbnQobmdBcHApLmluamVjdG9yKCk7XHJcbiAgICBkZXN0cm95QWxsU2NvcGVzKCk7XHJcblxyXG4gICAgZnVuY3Rpb24gZGVzdHJveUFsbFNjb3BlcygpIHtcclxuICAgICAgICB2YXIgcm9vdFNjb3BlID0gaW5qZWN0b3IuZ2V0KCckcm9vdFNjb3BlJyk7XHJcbiAgICAgICAgcm9vdFNjb3BlLiRicm9hZGNhc3QoXCIkZGVzdHJveVwiKTtcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY2xvc2VGcmFtZVdpbmRvdyhmcmFtZSk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XHJcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=