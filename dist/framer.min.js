(function (window) {
"use strict";
function Frame(e,t,n,i){this.type=e,this.name=t,this.src=n,this.options=i,this.frameElement=void 0}function FrameMessage(e,t,n,i,a){this.type=e,this.data=t,this.origin=n,this.target=i,this.messenger=a}function getClientByName(e){var t=window.top.framer.clients.filter(function(t){return t.name===e});return t=t.length>0?t[0]:null}window.framer={managers:[],clients:[],Manager:Manager,Client:Client,getClientByName:getClientByName,domLog:domLog};var ClientMessage="client",ManagerMessage="manager";
function closeFrameWindow(e,t){setTimeout(function(){try{e.frameElement.src=""}catch(n){}setTimeout(function(){e.frameElement.parentNode.removeChild(e.frameElement),e.frameElement=void 0,t.apply()},100)},0)}function createUrlArgs(e){var t=[],n=Object.getOwnPropertyNames(e);return n.forEach(function(n){var r=n+"="+encodeURI(e[n]);t.push(r)}),t.join("&")}function mergeOptions(e,t){var n=Object.getOwnPropertyNames(t);n.forEach(function(n){"undefined"==typeof e[n]&&(e[n]=t[n])})}function filterKeyPropertyValue(e,t,n,r,o){var i=filterByKeyValue(e,n,r,o);return"undefined"!=typeof i&&"undefined"!=typeof i[t]?i[t]:void 0}function filterByKeyValue(e,t,n,r){var o,i=e.filter(function(e){return e[t]===n});if(i.length>0){var a=0;r&&(a=i.length-1),o=i[a]}return o}function parseParams(e){e=e||resolveHashSearch();var t=[],n=parseUris(e);for(var r in n)t.push({name:r,data:n[r]});return t}function resolveHashSearch(){if(""!==document.location.search)return document.location.search;var e=document.location.hash,t=e.substring(e.indexOf("?")+1,e.length);return t}function tryDecodeURIComponent(e){try{return decodeURIComponent(e)}catch(t){console.error("There was an issue parsing the uri segment, check your iframe src",t)}}function parseUris(e){e=e.replace(/^\?/,"");for(var t,n,r={},o=(e||"").split("&"),i=0;i<o.length;i++){var a=o[i];if(a&&(t=a.replace(/\+/g,"%20").split("="),n=tryDecodeURIComponent(t[0]),isDefined(n))){var s=isDefined(t[1])?tryDecodeURIComponent(t[1]):!0;hasOwnProperty.call(r,n)?isArray(r[n])?r[n].push(s):r[n]=[r[n],s]:r[n]=s}}return r}function prependElement(e,t){return e.insertBefore(t,e.firstChild)}function setElementStyles(e,t){for(var n in t)e.style[n]=t[n]}function setElementAttributes(e,t){for(var n in t)e.setAttribute(n,t[n]);return e}function elementExistsByClassName(e){var t=window.document.getElementsByClassName(e);return t.length>0}function isDefined(e){return"undefined"!=typeof e}function domLog(e,t){var n="dom-log",r=document.getElementsByClassName(n)[0];r||(r=document.createElement("div"),r.className=n,r.style.position="absolute",r.style.top="0",r.style.right="0",prependElement(window.document.body,r));var o=document.createElement("p");o.innerText=e,o.style.color=t,o.style.fontSize="0.5em",r.appendChild(o)}
function Manager(e,t){var n=this.getManagerByName(e);return null!==n?(console.info("There is already a manager with the name",e),this.focus&&this.applyOptions(t),n):(this.applyOptions(t),this.name=e,this.frames=[],this.handlers=[],this.focus=null,this.persistentFrame=null,this.zIndex=99999,this.style={position:"fixed",top:"0px",left:"0px",bottom:"0px",right:"0px",width:"100%",height:"100%",border:"none",margin:"0",padding:"0",overflow:"hidden"},this.listen(),void window.framer.managers.push(this))}Manager.prototype.applyOptions=function(e){e&&e.container?(this.container=e.container,this.container.className+=" "+this.name):this.container=this.createFrameContainer(this.name)},Manager.prototype.getManagerByName=function(e){var t=window.framer.managers.filter(function(t){return t.name===e});return t=t.length>0?t[0]:null},Manager.prototype.receiveMessage=function(e){e.origin===document.location.origin&&(e.data.messenger!==ClientMessage||e.data.target!==this.name&&"undefined"!=typeof e.data.target||this.handleMessage(e.data))},Manager.prototype.destroy=function(){this.unListen()},Manager.prototype.listen=function(){this.listener=function(e){this.receiveMessage(e)}.bind(this),window.top.addEventListener("message",this.listener,!1)},Manager.prototype.unListen=function(){window.top.removeEventListener("message",this.listener),this.listener=void 0},Manager.prototype.send=function(e,t,n){var r=new FrameMessage(e,t,this.name,n,ManagerMessage);window.top.postMessage(r,document.location.origin)},Manager.prototype.on=function(e,t){filterByKeyValue(this.handlers,"type",e)?console.error("You already have a callback for type",e):this.handlers.push({type:e,callback:t})},Manager.prototype.add=function(e,t,n){var r=filterByKeyValue(this.frames,"name",e);if(r)return console.warn("Manager.add() there is already a frame named",e,"in the framer",this.name),r;n=n||{},isDefined(n.style)||(n.style=this.style),isDefined(n.append)||(n.append=!0),isDefined(n.persistent)||(n.persistent=!0);var s=new Frame(ClientMessage,e,t,n);return this.frames.push(s),s},Manager.prototype.open=function(e,t){var n=this.getFrame(e);return n?(this.focus&&this.focus!==n&&this.closeFrame(this.focus),this.focus=n,t&&mergeOptions(this.focus.options,t),this.openFrame(this.focus),n):void console.error("Manager open() there is no frame with that name",e)},Manager.prototype.openAbove=function(e,t){t=t||{},t.style=t.style||{};var n=this.getFrame(e);return n?(t.style.zIndex||(t.style.zIndex=n.style.zIndex+1),this.openFrame(n,t),n):void console.error("Manager open() there is no frame with that name",e)},Manager.prototype.close=function(e,t){var n=this.getFrame(e);return n?(this.closeFrame(n,t),void(this.focus=null)):void console.warn("Manager close() there is no frame with that name",e)},Manager.prototype.handleMessage=function(e){var t=filterByKeyValue(this.handlers,"type",e.type);t&&t.callback.apply(this,[e.data])},Manager.prototype.openFrame=function(e,t){if(t&&mergeOptions(e.options,t),e.options.persistent)this.setPersistentFrame(e);else if(e.frameElement)console.warn("Manager",this.name,"already has",e.name,"open");else if(this.createFrameElement(e),e.options.append){var n=this.container;e.options.parent&&(n=e.options.parent),prependElement(n,e.frameElement)}},Manager.prototype.closeFrame=function(e,t){if(e.options.persistent&&null!==this.persistentFrame){this.persistentFrame.src="about:blank",this.persistentFrame.style.visibility="hidden";var n=window.top.framer.getClientByName(e.name);n&&n.destroy(),t&&t.apply()}else if(e.frameElement){var n=window.top.framer.getClientByName(e.name);n&&n.destroy(),closeFrameWindow(e,t)}else console.warn("Manager",this.name,"frame",e.name,"is not open to close"),t&&t.apply()},Manager.prototype.getFrame=function(e){var t;return"string"==typeof e?t=this.getFrameByName(e):Object.getOwnPropertyNames(e).name&&(t=this.frames.indexOf(e)),t},Manager.prototype.getFrameByName=function(e){var t=null,n=this.frames.filter(function(t){return t.name===e});return n.length>0&&(t=n[0]),t},Manager.prototype.setPersistentFrame=function(e){if(null===this.persistentFrame&&(this.persistentFrame=document.createElement("iframe")),this.persistentFrame.parent!==this.container&&prependElement(this.container,this.persistentFrame),e.frameElement&&e.options.src){var t=window.top.framer.getClientByName(e.name);t&&t.destroy(),this.openPersistentFrame(e)}else this.openPersistentFrame(e)},Manager.prototype.openPersistentFrame=function(e){var t=e.options,n=t.src||e.src;t.src&&(t.src=void 0),t.arguments=t.arguments||{},t.style=t.style||{},t.attributes=t.attributes||{};var r=createUrlArgs(t.arguments),s="&name="+e.name+"&"+r,a="?origin="+encodeURIComponent(document.location.href);setElementStyles(this.persistentFrame,t.style),setElementAttributes(this.persistentFrame,t.attributes),this.persistentFrame.id=e.name,this.persistentFrame.src=n+a+s,this.persistentFrame.style.visibility="visible",this.persistentFrame.sandbox="allow-forms allow-scripts allow-same-origin",e.frameElement=this.persistentFrame},Manager.prototype.createFrameElement=function(e){var t=e.options,n=t.src||e.src;t.src&&(t.src=void 0),t.arguments=t.arguments||{},t.style=t.style||{},t.attributes=t.attributes||{};var r=createUrlArgs(t.arguments),s="&name="+e.name+"&"+r,a="?origin="+encodeURIComponent(document.location.href),i=document.createElement("iframe");return setElementStyles(i,t.style),setElementAttributes(i,t.attributes),i.id=e.name,i.src=n+a+s,i.sandbox="allow-forms allow-scripts allow-same-origin",e.frameElement=i,e},Manager.prototype.createFrameContainer=function(e){var t;return elementExistsByClassName(e)||(t=window.document.createElement("div"),t.className=e,t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.zIndex=this.zIndex,prependElement(window.document.body,t)),t};
function Client(e,i){if(this.params=parseParams(),this.name=e||filterKeyPropertyValue(this.params,"data","name","name",!0),this.origin=i||filterKeyPropertyValue(this.params,"data","name","origin"),!isDefined(this.name)||!isDefined(this.origin))return void console.info("A Framer Client will not work without the correct origin and name url args, origin and name");var t=window.top.framer.getClientByName(this.name);if(null!==t){console.warn("There is already a client with the name, we are now replacing it",this.name);var n=window.top.framer.clients.indexOf(t);t.destroy(),window.top.framer.clients.splice(n,1),t=void 0}this.handlers=[],this.listen(),window.top.framer.clients.push(this)}Client.prototype.send=function(e,i,t){if(!isDefined(this.name)||!isDefined(this.origin))return void console.warn("Framer Client has no Manager to send",e,i);var n=new FrameMessage(e,i,this.name,t,ClientMessage);window.top.postMessage(n,this.origin)},Client.prototype.on=function(e,i){filterByKeyValue(this.handlers,"type",e)?console.error("You already have a callback for type",name):this.handlers.push({type:e,callback:i})},Client.prototype.receiveMessage=function(e){("undefined"==typeof window.top||"null"==typeof window.top)&&console.error("Client has a recieve message when window top is",typeof window.top),e&&e.origin&&e.origin!==window.top.document.location.origin||e.data.messenger!==ManagerMessage||e.data.target!==this.name&&"undefined"!=typeof e.data.target||this.handleMessage(e.data)},Client.prototype.destroy=function(e){console.info("Framer Client",this.name,"is being destroyed"),this.unListen(),this.handlers=[];var i=window.top.framer.clients.indexOf(this);window.top.framer.clients.splice(i,1),e&&e.apply()},Client.prototype.listen=function(){this.listener=function(e){this.receiveMessage(e)}.bind(this),window.top.addEventListener("message",this.listener,!1)},Client.prototype.unListen=function(){window.top.removeEventListener("message",this.listener),this.listener=void 0},Client.prototype.handleMessage=function(e){var i=filterByKeyValue(this.handlers,"type",e.type);i&&i.callback.apply(this,[e.data])};
})(window);
//# sourceMappingURL=framer.min.js.map