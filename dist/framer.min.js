(function (window) {
"use strict";
function Frame(e,t,i,r){this.type=e,this.name=t,this.src=i,this.options=r,this.frameElement=void 0}function FrameMessage(e,t,i,r,s){this.type=e,this.data=t,this.origin=i,this.target=r,this.messenger=s}window.framer={Manager:Manager,Client:Client,domLog:domLog};var FramerClientMessengerType="frame-client",FramerMessengerType="framer";
function closeFrameWindow(e){setTimeout(function(){try{e.frameElement.src="about:blank"}catch(t){}setTimeout(function(){e.frameElement.parentNode.removeChild(e.frameElement),e.frameElement=void 0},100)},0)}function createUrlArgs(e){var t=[],n=Object.getOwnPropertyNames(e);return n.forEach(function(n){var r=n+"="+encodeURI(e[n]);t.push(r)}),t.join("&")}function mergeOptions(e,t){var n=Object.getOwnPropertyNames(t);n.forEach(function(n){"undefined"==typeof e[n]&&(e[n]=t[n])})}function filterByKeyValue(e,t,n,r){var o,a=e.filter(function(e){return e[t]===n});if(a.length>0){var i=0;r&&(i=a.length-1),o=a[i]}return o}function parseParams(e){e=e||resolveHashSearch();var t=[],n=parseUris(e);for(var r in n)t.push({name:r,data:n[r]});return t}function resolveHashSearch(){if(""!==document.location.search)return document.location.search;var e=document.location.hash,t=e.substring(e.indexOf("?")+1,e.length);return t}function tryDecodeURIComponent(e){try{return decodeURIComponent(e)}catch(t){console.error("There was an issue parsing the uri segment, check your iframe src",t)}}function parseUris(e){e=e.replace(/^\?/,"");for(var t,n,r={},o=(e||"").split("&"),a=0;a<o.length;a++){var i=o[a];if(i&&(t=i.replace(/\+/g,"%20").split("="),n=tryDecodeURIComponent(t[0]),isDefined(n))){var s=isDefined(t[1])?tryDecodeURIComponent(t[1]):!0;hasOwnProperty.call(r,n)?isArray(r[n])?r[n].push(s):r[n]=[r[n],s]:r[n]=s}}return r}function prependElement(e,t){return e.insertBefore(t,e.firstChild)}function setElementStyles(e,t){for(var n in t)e.style[n]=t[n]}function setElementAttributes(e,t){for(var n in t)e.setAttribute(n,t[n]);return e}function elementExistsByClassName(e){var t=window.document.getElementsByClassName(e);return t.length>0}function isDefined(e){return"undefined"!=typeof e}function domLog(e,t){var n="dom-log",r=document.getElementsByClassName(n)[0];r||(r=document.createElement("div"),r.className=n,r.style.position="absolute",r.style.top="0",r.style.right="0",prependElement(window.document.body,r));var o=document.createElement("p");o.innerText=e,o.style.color=t,o.style.fontSize="0.5em",r.appendChild(o)}
function Manager(e){this.name=e,this.frames=[],this.handlers=[],this.focus=null,this.zIndex=99999,this.container=this.createFrameContainer(this.name),this.style={position:"fixed",top:"0px",left:"0px",bottom:"0px",right:"0px",width:"100%",height:"100%",border:"none",margin:"0",padding:"0",overflow:"hidden"},this.receiveMessage=function(e){e.origin===document.location.origin&&(e.data.messenger!==FramerClientMessengerType||e.data.target!==this.name&&"undefined"!=typeof e.data.target||this.handleMessage(e.data))}.bind(this),window.addEventListener("message",this.receiveMessage,!1)}Manager.prototype.send=function(e,t,n){var a=new FrameMessage(e,t,this.name,n,FramerMessengerType);window.postMessage(a,document.location.origin)},Manager.prototype.receive=function(e,t){filterByKeyValue(this.handlers,"type",e)?console.error("You already have a callback for type",e):this.handlers.push({type:e,callback:t})},Manager.prototype.add=function(e,t,n){var a=filterByKeyValue(this.frames,"name",e);if(a)return console.warn("Manager.add() there is already a frame named",e,"in the framer",this.name),a;n=n||{},isDefined(n.style)||(n.style=this.style),isDefined(n.append)||(n.append=!0);var r=new Frame(FramerClientMessengerType,e,t,n);return this.frames.push(r),r},Manager.prototype.open=function(e,t){var n=this.getFrame(e);return n?(this.focus&&this.focus!==n&&this.closeFrame(this.focus),this.focus=n,t&&mergeOptions(this.focus.options,t),this.openFrame(this.focus),n):void console.error("Manager open() there is no frame with that name",e)},Manager.prototype.openAbove=function(e,t){t=t||{},t.style=t.style||{};var n=this.getFrame(e);return n?(t.style.zIndex||(t.style.zIndex=n.style.zIndex+1),this.openFrame(n,t),n):void console.error("Manager open() there is no frame with that name",e)},Manager.prototype.close=function(e){var t=this.getFrame(e);return t?(this.closeFrame(t),void(this.focus=null)):void console.warn("Manager close() there is no frame with that name",e)},Manager.prototype.handleMessage=function(e){var t=filterByKeyValue(this.handlers,"type",e.type);t&&t.callback.apply(this,[e.data])},Manager.prototype.openFrame=function(e,t){if(t&&mergeOptions(e.options,t),e.frameElement)console.warn("Manager",this.name,"already has",e.name,"open");else if(this.createFrameElement(e),e.options.append){var n=this.container;e.options.parent&&(n=e.options.parent),prependElement(n,e.frameElement)}},Manager.prototype.closeFrame=function(e){if(e.frameElement){var t=e.frameElement.contentWindow;console.log("frame options",e.options),e.options.angularAppId&&t.angular?angularCloseFrameWindow(e):closeFrameWindow(e)}else console.warn("Manager",this.name,"frame",e.name,"is not open to close")},Manager.prototype.getFrame=function(e){var t;return"string"==typeof e?t=this.getFrameByName(e):Object.getOwnPropertyNames(e).name&&(t=this.frames.indexOf(e)),t},Manager.prototype.getFrameByName=function(e){var t,n=this.frames.filter(function(t){return t.name===e});return n.length>0&&(t=n[0]),t},Manager.prototype.createFrameElement=function(e){var t=e.src,n=e.options;n.arguments=n.arguments||{},n.style=n.style||{},n.attributes=n.attributes||{};var a=createUrlArgs(n.arguments),r="&name="+e.name+"&"+a,o="?origin="+encodeURIComponent(document.location.href),s=document.createElement("iframe");return setElementStyles(s,n.style),setElementAttributes(s,n.attributes),s.id=e.name,s.src=t+o+r,s.sandbox="allow-forms allow-scripts allow-same-origin",e.frameElement=s,e},Manager.prototype.createFrameContainer=function(e){var t;return elementExistsByClassName(e)||(t=window.document.createElement("div"),t.className=e,t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.zIndex=this.zIndex,prependElement(window.document.body,t)),t};
function Client(){this.handlers=[],this.params=parseParams();var e=filterByKeyValue(this.params,"name","name",!0),a=filterByKeyValue(this.params,"name","origin");return isDefined(e)&&isDefined(a)?(this.name=e.data,this.origin=a.data,this.receiveMessage=function(e){e.origin===document.location.origin&&(e.data.messenger!==FramerMessengerType||e.data.target!==this.name&&"undefined"!=typeof e.data.target||this.handleMessage(e.data))}.bind(this),void window.parent.window.addEventListener("message",this.receiveMessage,!1)):void console.info("Manager will not work without the correct origin and name url args")}Client.prototype.handleMessage=function(e){var a=filterByKeyValue(this.handlers,"type",e.type);a&&a.callback.apply(this,[e.data])},Client.prototype.send=function(e,a,t){var i=new FrameMessage(e,a,this.name,t,FramerClientMessengerType);window.parent.postMessage(i,this.origin)},Client.prototype.receive=function(e,a){filterByKeyValue(this.handlers,"type",e)?console.error("You already have a callback for type",name):this.handlers.push({type:e,callback:a})};
function angularCloseFrameWindow(e){function n(){var n=a.get("$rootScope");n.$broadcast("$destroy"),setTimeout(function(){closeFrameWindow(e)},0)}var o=e.frameElement.contentWindow,t=o.angular.element(o.document.getElementById(e.options.angularAppId));console.log("ngApp",t);var a=o.angular.element(t).injector();n()}
})(window);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZyYW1lci5qcyIsInV0aWwuanMiLCJNYW5hZ2VyLmpzIiwiQ2xpZW50LmpzIiwiYW5ndWxhci1mcmFtZS5qcyJdLCJuYW1lcyI6WyJGcmFtZSIsInR5cGUiLCJuYW1lIiwic3JjIiwib3B0aW9ucyIsInRoaXMiLCJmcmFtZUVsZW1lbnQiLCJ1bmRlZmluZWQiLCJGcmFtZU1lc3NhZ2UiLCJkYXRhIiwib3JpZ2luIiwidGFyZ2V0IiwibWVzc2VuZ2VyIiwid2luZG93IiwiZnJhbWVyIiwiTWFuYWdlciIsIkNsaWVudCIsImRvbUxvZyIsIkZyYW1lckNsaWVudE1lc3NlbmdlclR5cGUiLCJGcmFtZXJNZXNzZW5nZXJUeXBlIiwiY2xvc2VGcmFtZVdpbmRvdyIsImZyYW1lIiwic2V0VGltZW91dCIsImV4IiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiY3JlYXRlVXJsQXJncyIsImFyZ3MiLCJhcmdzTGlzdCIsInByb3BlcnRpZXMiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwiZm9yRWFjaCIsImVuY29kZWRBcmciLCJlbmNvZGVVUkkiLCJwdXNoIiwiam9pbiIsIm1lcmdlT3B0aW9ucyIsImV4aXN0aW5nIiwiY3VzdG9tIiwia2V5cyIsImtleSIsImZpbHRlckJ5S2V5VmFsdWUiLCJjb2xsZWN0aW9uIiwidmFsdWUiLCJsYXN0IiwibmVlZGxlIiwicmVzdWx0IiwiZmlsdGVyIiwiaXRlbSIsImxlbmd0aCIsInJlc3VsdEluZGV4IiwicGFyc2VQYXJhbXMiLCJoYXNoIiwicmVzb2x2ZUhhc2hTZWFyY2giLCJwYXJhbWV0ZXJzIiwic2VnbWVudHMiLCJwYXJzZVVyaXMiLCJkb2N1bWVudCIsImxvY2F0aW9uIiwic2VhcmNoIiwic3RyaXBwZWRIYXNoIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsInRyeURlY29kZVVSSUNvbXBvbmVudCIsImRlY29kZVVSSUNvbXBvbmVudCIsImVycm9yIiwiY29uc29sZSIsImtleVZhbHVlIiwicmVwbGFjZSIsInNlZ21lbnRSZXN1bHRzIiwic3BsaXQiLCJpIiwia1ZhbHVlIiwiaXNEZWZpbmVkIiwidmFsIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaXNBcnJheSIsInByZXBlbmRFbGVtZW50IiwicGFyZW50RWxlbWVudCIsImVsZW1lbnQiLCJpbnNlcnRCZWZvcmUiLCJmaXJzdENoaWxkIiwic2V0RWxlbWVudFN0eWxlcyIsInN0eWxlcyIsInN0eWxlIiwic2V0RWxlbWVudEF0dHJpYnV0ZXMiLCJhdHRyaWJ1dGVzIiwiYXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwiZWxlbWVudEV4aXN0c0J5Q2xhc3NOYW1lIiwiY2xhc3NOYW1lIiwiZXhpc3RpbmdFbGVtZW50cyIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJtZXNzYWdlIiwiY29sb3IiLCJjb250YWluZXIiLCJjcmVhdGVFbGVtZW50IiwicG9zaXRpb24iLCJ0b3AiLCJyaWdodCIsImJvZHkiLCJsb2dNZXNzYWdlIiwiaW5uZXJUZXh0IiwiZm9udFNpemUiLCJhcHBlbmRDaGlsZCIsImZyYW1lcyIsImhhbmRsZXJzIiwiZm9jdXMiLCJ6SW5kZXgiLCJjcmVhdGVGcmFtZUNvbnRhaW5lciIsImxlZnQiLCJib3R0b20iLCJ3aWR0aCIsImhlaWdodCIsImJvcmRlciIsIm1hcmdpbiIsInBhZGRpbmciLCJvdmVyZmxvdyIsInJlY2VpdmVNZXNzYWdlIiwiZXZlbnQiLCJoYW5kbGVNZXNzYWdlIiwiYmluZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJwcm90b3R5cGUiLCJzZW5kIiwicG9zdE1lc3NhZ2UiLCJyZWNlaXZlIiwiY2FsbGJhY2siLCJhZGQiLCJ3YXJuIiwiYXBwZW5kIiwib3BlbiIsImdldEZyYW1lIiwiY2xvc2VGcmFtZSIsIm9wZW5GcmFtZSIsIm9wZW5BYm92ZSIsImNsb3NlIiwiYXBwbHkiLCJjcmVhdGVGcmFtZUVsZW1lbnQiLCJwYXJlbnQiLCJjaGlsZFdpbmRvdyIsImNvbnRlbnRXaW5kb3ciLCJsb2ciLCJhbmd1bGFyQXBwSWQiLCJhbmd1bGFyIiwiYW5ndWxhckNsb3NlRnJhbWVXaW5kb3ciLCJleGlzdGluZ0ZyYW1lIiwiZ2V0RnJhbWVCeU5hbWUiLCJhcmd1bWVudHMiLCJwYXJhbXMiLCJlbmNvZGVVUklDb21wb25lbnQiLCJocmVmIiwiaWZyYW1lIiwiaWQiLCJzYW5kYm94IiwiaW5mbyIsImRlc3Ryb3lBbGxTY29wZXMiLCJyb290U2NvcGUiLCJpbmplY3RvciIsImdldCIsIiRicm9hZGNhc3QiLCJuZ0FwcCIsImdldEVsZW1lbnRCeUlkIl0sIm1hcHBpbmdzIjoiQUFTQSxRQUFTQSxPQUFNQyxFQUFNQyxFQUFNQyxFQUFLQyxHQUM1QkMsS0FBS0osS0FBT0EsRUFDWkksS0FBS0gsS0FBT0EsRUFDWkcsS0FBS0YsSUFBTUEsRUFDWEUsS0FBS0QsUUFBVUEsRUFDZkMsS0FBS0MsYUFBZUMsT0FHeEIsUUFBU0MsY0FBYVAsRUFBTVEsRUFBTUMsRUFBUUMsRUFBUUMsR0FDOUNQLEtBQUtKLEtBQU9BLEVBQ1pJLEtBQUtJLEtBQU9BLEVBQ1pKLEtBQUtLLE9BQVNBLEVBQ2RMLEtBQUtNLE9BQVNBLEVBQ2ROLEtBQUtPLFVBQVlBLEVBdEJyQkMsT0FBT0MsUUFDSEMsUUFBU0EsUUFDVEMsT0FBUUEsT0FDUkMsT0FBUUEsT0FHWixJQUFJQywyQkFBNEIsZUFDNUJDLG9CQUFzQjtBQ1AxQixRQUFTQyxrQkFBaUJDLEdBQ3RCQyxXQUFXLFdBQ1AsSUFDSUQsRUFBTWYsYUFBYUgsSUFBTSxjQUU3QixNQUFPb0IsSUFHUEQsV0FBVyxXQUNQRCxFQUFNZixhQUFha0IsV0FBV0MsWUFBWUosRUFBTWYsY0FDaERlLEVBQU1mLGFBQWVDLFFBQ3RCLE1BQ0osR0FHUCxRQUFTbUIsZUFBY0MsR0FDbkIsR0FBSUMsTUFDQUMsRUFBYUMsT0FBT0Msb0JBQW9CSixFQU81QyxPQUxBRSxHQUFXRyxRQUFRLFNBQTBCOUIsR0FDekMsR0FBSStCLEdBQWEvQixFQUFPLElBQU1nQyxVQUFVUCxFQUFLekIsR0FDN0MwQixHQUFTTyxLQUFLRixLQUdYTCxFQUFT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RixLQUFLSyxTQUc1Q00sT0FBTzZHLFVBQVVHLFFBQVUsU0FBVS9ILEVBQU1nSSxHQUNsQ3ZGLGlCQUFpQnJDLEtBQUt1RyxTQUFVLE9BQVEzRyxHQU16Q2tFLFFBQVFELE1BQU0sdUNBQXdDaEUsTUFMdERHLEtBQUt1RyxTQUFTekUsTUFDVmxDLEtBQU1BLEVBQ05nSSxTQUFVQTtBQzNDdEIsUUFBU2tCLHlCQUF3QjlILEdBUTdCLFFBQVN5SSxLQUNMLEdBQUlDLEdBQVlDLEVBQVNDLElBQUksYUFDN0JGLEdBQVVHLFdBQVcsWUFDckI1SSxXQUFXLFdBQ1BGLGlCQUFpQkMsSUFDbEIsR0FaUCxHQUFJeUgsR0FBY3pILEVBQU1mLGFBQWF5SSxjQUNqQ29CLEVBQVFyQixFQUFZSSxRQUFRakUsUUFBUTZELEVBQVlwRixTQUFTMEcsZUFBZS9JLEVBQU1qQixRQUFRNkksY0FDMUY5RSxTQUFRNkUsSUFBSSxRQUFTbUIsRUFFckIsSUFBSUgsR0FBV2xCLEVBQVlJLFFBQVFqRSxRQUFRa0YsR0FBT0gsVUFDbERGIiwiZmlsZSI6ImZyYW1lci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ3aW5kb3cuZnJhbWVyID0ge1xyXG4gICAgTWFuYWdlcjogTWFuYWdlcixcclxuICAgIENsaWVudDogQ2xpZW50LFxyXG4gICAgZG9tTG9nOiBkb21Mb2dcclxufTtcclxuXHJcbnZhciBGcmFtZXJDbGllbnRNZXNzZW5nZXJUeXBlID0gJ2ZyYW1lLWNsaWVudCc7XHJcbnZhciBGcmFtZXJNZXNzZW5nZXJUeXBlID0gJ2ZyYW1lcic7XHJcblxyXG5mdW5jdGlvbiBGcmFtZSh0eXBlLCBuYW1lLCBzcmMsIG9wdGlvbnMpIHtcclxuICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgdGhpcy5zcmMgPSBzcmM7XHJcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgdGhpcy5mcmFtZUVsZW1lbnQgPSB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIEZyYW1lTWVzc2FnZSh0eXBlLCBkYXRhLCBvcmlnaW4sIHRhcmdldCwgbWVzc2VuZ2VyKSB7XHJcbiAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG4gICAgdGhpcy5kYXRhID0gZGF0YTtcclxuICAgIHRoaXMub3JpZ2luID0gb3JpZ2luO1xyXG4gICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICB0aGlzLm1lc3NlbmdlciA9IG1lc3NlbmdlcjtcclxufSIsImZ1bmN0aW9uIGNsb3NlRnJhbWVXaW5kb3coZnJhbWUpIHtcclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGZyYW1lLmZyYW1lRWxlbWVudC5zcmMgPSAnYWJvdXQ6YmxhbmsnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgLy8gRG8gbm90aGluZ1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZnJhbWUuZnJhbWVFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZnJhbWUuZnJhbWVFbGVtZW50KTtcclxuICAgICAgICAgICAgZnJhbWUuZnJhbWVFbGVtZW50ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH0sIDEwMCk7XHJcbiAgICB9LCAwKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlVXJsQXJncyhhcmdzKSB7XHJcbiAgICB2YXIgYXJnc0xpc3QgPSBbXTtcclxuICAgIHZhciBwcm9wZXJ0aWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYXJncyk7XHJcblxyXG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIHByb3BlcnR5UmVzb2x2ZXIobmFtZSkge1xyXG4gICAgICAgIHZhciBlbmNvZGVkQXJnID0gbmFtZSArICc9JyArIGVuY29kZVVSSShhcmdzW25hbWVdKTtcclxuICAgICAgICBhcmdzTGlzdC5wdXNoKGVuY29kZWRBcmcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGFyZ3NMaXN0LmpvaW4oJyYnKTtcclxufVxyXG5cclxuZnVuY3Rpb24gbWVyZ2VPcHRpb25zKGV4aXN0aW5nLCBjdXN0b20pIHtcclxuICAgIHZhciBrZXlzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VzdG9tKTtcclxuICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBleGlzdGluZ1trZXldID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICBleGlzdGluZ1trZXldID0gY3VzdG9tW2tleV07XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpbHRlckJ5S2V5VmFsdWUoY29sbGVjdGlvbiwga2V5LCB2YWx1ZSwgbGFzdCkge1xyXG4gICAgdmFyIG5lZWRsZTtcclxuICAgIHZhciByZXN1bHQgPSBjb2xsZWN0aW9uLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgIHJldHVybiBpdGVtW2tleV0gPT09IHZhbHVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdEluZGV4ID0gMDtcclxuICAgICAgICBpZiAobGFzdCkge1xyXG4gICAgICAgICAgICByZXN1bHRJbmRleCA9IHJlc3VsdC5sZW5ndGggLSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBuZWVkbGUgPSByZXN1bHRbcmVzdWx0SW5kZXhdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5lZWRsZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VQYXJhbXMoaGFzaCkge1xyXG4gICAgaGFzaCA9IGhhc2ggfHwgcmVzb2x2ZUhhc2hTZWFyY2goKTtcclxuICAgIHZhciBwYXJhbWV0ZXJzID0gW107XHJcblxyXG4gICAgdmFyIHNlZ21lbnRzID0gcGFyc2VVcmlzKGhhc2gpO1xyXG4gICAgZm9yICh2YXIgbmFtZSBpbiBzZWdtZW50cykge1xyXG4gICAgICAgIHBhcmFtZXRlcnMucHVzaCh7XHJcbiAgICAgICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgICAgIGRhdGE6IHNlZ21lbnRzW25hbWVdXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBhcmFtZXRlcnM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlc29sdmVIYXNoU2VhcmNoKCkge1xyXG4gICAgaWYgKGRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaCAhPT0gJycpIHtcclxuICAgICAgICByZXR1cm4gZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB2YXIgaGFzaCA9IGRvY3VtZW50LmxvY2F0aW9uLmhhc2g7XHJcbiAgICAgICAgdmFyIHN0cmlwcGVkSGFzaCA9IGhhc2guc3Vic3RyaW5nKGhhc2guaW5kZXhPZignPycpICsgMSwgaGFzaC5sZW5ndGgpO1xyXG4gICAgICAgIHJldHVybiBzdHJpcHBlZEhhc2g7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRyeURlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignVGhlcmUgd2FzIGFuIGlzc3VlIHBhcnNpbmcgdGhlIHVyaSBzZWdtZW50LCBjaGVjayB5b3VyIGlmcmFtZSBzcmMnLCBlcnJvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhcnNlVXJpcyhrZXlWYWx1ZSkge1xyXG4gICAga2V5VmFsdWUgPSBrZXlWYWx1ZS5yZXBsYWNlKC9eXFw/LywgJycpO1xyXG4gICAgdmFyIHNlZ21lbnRSZXN1bHRzID0ge30sIHZhbHVlLCBrZXk7XHJcbiAgICB2YXIgc2VnbWVudHMgPSAoa2V5VmFsdWUgfHwgXCJcIikuc3BsaXQoJyYnKTtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VnbWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB2YXIga1ZhbHVlID0gc2VnbWVudHNbaV07XHJcbiAgICAgICAgaWYgKGtWYWx1ZSkge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IGtWYWx1ZS5yZXBsYWNlKC9cXCsvZywgJyUyMCcpLnNwbGl0KCc9Jyk7XHJcbiAgICAgICAgICAgIGtleSA9IHRyeURlY29kZVVSSUNvbXBvbmVudCh2YWx1ZVswXSk7XHJcbiAgICAgICAgICAgIGlmIChpc0RlZmluZWQoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbCA9IGlzRGVmaW5lZCh2YWx1ZVsxXSkgPyB0cnlEZWNvZGVVUklDb21wb25lbnQodmFsdWVbMV0pIDogdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmICghaGFzT3duUHJvcGVydHkuY2FsbChzZWdtZW50UmVzdWx0cywga2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlZ21lbnRSZXN1bHRzW2tleV0gPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzQXJyYXkoc2VnbWVudFJlc3VsdHNba2V5XSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWdtZW50UmVzdWx0c1trZXldLnB1c2godmFsKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VnbWVudFJlc3VsdHNba2V5XSA9IFtzZWdtZW50UmVzdWx0c1trZXldLCB2YWxdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNlZ21lbnRSZXN1bHRzO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwcmVwZW5kRWxlbWVudChwYXJlbnRFbGVtZW50LCBlbGVtZW50KSB7XHJcbiAgICByZXR1cm4gcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoZWxlbWVudCwgcGFyZW50RWxlbWVudC5maXJzdENoaWxkKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0RWxlbWVudFN0eWxlcyhlbGVtZW50LCBzdHlsZXMpIHtcclxuICAgIGZvciAodmFyIHN0eWxlIGluIHN0eWxlcykge1xyXG4gICAgICAgIGVsZW1lbnQuc3R5bGVbc3R5bGVdID0gc3R5bGVzW3N0eWxlXTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2V0RWxlbWVudEF0dHJpYnV0ZXMoZWxlbWVudCwgYXR0cmlidXRlcykge1xyXG4gICAgZm9yICh2YXIgYXR0cmlidXRlIGluIGF0dHJpYnV0ZXMpIHtcclxuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShhdHRyaWJ1dGUsIGF0dHJpYnV0ZXNbYXR0cmlidXRlXSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZWxlbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gZWxlbWVudEV4aXN0c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSkge1xyXG4gICAgdmFyIGV4aXN0aW5nRWxlbWVudHMgPSB3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWUpO1xyXG4gICAgcmV0dXJuIGV4aXN0aW5nRWxlbWVudHMubGVuZ3RoID4gMDtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNEZWZpbmVkKHZhbHVlKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJztcclxufVxyXG5cclxuLyoqXHJcbiAqIFNpbXBsZSB1dGlsaXR5IHRvIGxvZyBtZXNzYWdlcyB0byB0aGUgZG9tLlxyXG4gKiBAcGFyYW0gbWVzc2FnZVxyXG4gKiBAcGFyYW0gY29sb3JcclxuICovXHJcbmZ1bmN0aW9uIGRvbUxvZyhtZXNzYWdlLCBjb2xvcikge1xyXG4gICAgdmFyIGNsYXNzTmFtZSA9ICdkb20tbG9nJztcclxuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSlbMF07XHJcbiAgICBpZiAoIWNvbnRhaW5lcikge1xyXG4gICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBjbGFzc05hbWU7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgICAgICBjb250YWluZXIuc3R5bGUudG9wID0gJzAnO1xyXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5yaWdodCA9ICcwJztcclxuICAgICAgICBwcmVwZW5kRWxlbWVudCh3aW5kb3cuZG9jdW1lbnQuYm9keSwgY29udGFpbmVyKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgbG9nTWVzc2FnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgIGxvZ01lc3NhZ2UuaW5uZXJUZXh0ID0gbWVzc2FnZTtcclxuICAgIGxvZ01lc3NhZ2Uuc3R5bGUuY29sb3IgPSBjb2xvcjtcclxuICAgIGxvZ01lc3NhZ2Uuc3R5bGUuZm9udFNpemUgPSAnMC41ZW0nO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGxvZ01lc3NhZ2UpO1xyXG59IiwiXHJcbi8qKlxyXG4gKiBNYW5hZ2VyIGlzIHRoZSBtYW5hZ2VyIG9mIGEgc2V0IG9mIGlmcmFtZS93ZWJ2aWV3IGVsZW1lbnRzXHJcbiAqIHRoYXQgY2FuIGNvbW11bmljYXRlIHdpdGggc2VuZCBhbmQgcmVjZWl2ZS5cclxuICpcclxuICogQHBhcmFtIG5hbWVcclxuICogQGNvbnN0cnVjdG9yXHJcbiAqL1xyXG5mdW5jdGlvbiBNYW5hZ2VyKG5hbWUpIHtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLmZyYW1lcyA9IFtdO1xyXG4gICAgdGhpcy5oYW5kbGVycyA9IFtdO1xyXG4gICAgdGhpcy5mb2N1cyA9IG51bGw7XHJcbiAgICB0aGlzLnpJbmRleCA9IDk5OTk5O1xyXG4gICAgdGhpcy5jb250YWluZXIgPSB0aGlzLmNyZWF0ZUZyYW1lQ29udGFpbmVyKHRoaXMubmFtZSk7XHJcbiAgICAvLyBUaGUgZGVmYXVsdCBzdHlsZSB3aWxsIG1ha2UgdGhlIGZyYW1lcyBmdWxsc2NyZWVuIGFzIGlmIHRoaXMgaXMgYVxyXG4gICAgLy8gc2luZ2xlIGZyYW1lIGFwcGxpY2F0aW9uIDspXHJcbiAgICB0aGlzLnN0eWxlID0ge1xyXG4gICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxyXG4gICAgICAgIHRvcDogJzBweCcsXHJcbiAgICAgICAgbGVmdDogJzBweCcsXHJcbiAgICAgICAgYm90dG9tOiAnMHB4JyxcclxuICAgICAgICByaWdodDogJzBweCcsXHJcbiAgICAgICAgd2lkdGg6ICcxMDAlJyxcclxuICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcclxuICAgICAgICBib3JkZXI6ICdub25lJyxcclxuICAgICAgICBtYXJnaW46ICcwJyxcclxuICAgICAgICBwYWRkaW5nOiAnMCcsXHJcbiAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucmVjZWl2ZU1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICBpZiAoZXZlbnQub3JpZ2luICE9PSBkb2N1bWVudC5sb2NhdGlvbi5vcmlnaW4pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGV2ZW50LmRhdGEubWVzc2VuZ2VyID09PSBGcmFtZXJDbGllbnRNZXNzZW5nZXJUeXBlICYmXHJcbiAgICAgICAgICAgIChldmVudC5kYXRhLnRhcmdldCA9PT0gdGhpcy5uYW1lIHx8IHR5cGVvZiBldmVudC5kYXRhLnRhcmdldCA9PT0gJ3VuZGVmaW5lZCcpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlTWVzc2FnZShldmVudC5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9LmJpbmQodGhpcyk7XHJcblxyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLnJlY2VpdmVNZXNzYWdlLCBmYWxzZSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZW5kIGEgbWVzc2FnZSB0byBhIENsaWVudCwgaWYgbm8gdGFyZ2V0IGlzIHNwZWNpZmllZCBzZW5kIHRvIGFsbC5cclxuICogQHBhcmFtIHR5cGUgdGhlIG1lc3NhZ2UgdHlwZSB0byB1c2UgYmFzZWQgdGhhdCBkZXNjcmliZXMgdGhlIGZlYXR1cmUsIGVnIHN1Ym1pdCwgc2VuZCwgbG9nb3V0XHJcbiAqIEBwYXJhbSBkYXRhIHRoZSBvYXRcclxuICogQHBhcmFtIHRhcmdldFxyXG4gKi9cclxuTWFuYWdlci5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uICh0eXBlLCBkYXRhLCB0YXJnZXQpIHtcclxuICAgIHZhciBtZXNzYWdlID0gbmV3IEZyYW1lTWVzc2FnZSh0eXBlLCBkYXRhLCB0aGlzLm5hbWUsIHRhcmdldCwgRnJhbWVyTWVzc2VuZ2VyVHlwZSk7XHJcbiAgICB3aW5kb3cucG9zdE1lc3NhZ2UobWVzc2FnZSwgZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZWNlaXZlIGEgbWVzc2FnZSBvbiBhIE1hbmFnZXIgaW5zdGFuY2UuIFRoZSBjYWxsYmFjayB3aWxsIHJlY2lldmUgdGhlIGRhdGFcclxuICogdmFsdWUgc2VudCB3aXRoIE1hbmFnZXIucHJvdG90eXBlLnNlbmQoKVxyXG4gKiBAcGFyYW0gdHlwZVxyXG4gKiBAcGFyYW0gY2FsbGJhY2tcclxuICovXHJcbk1hbmFnZXIucHJvdG90eXBlLnJlY2VpdmUgPSBmdW5jdGlvbiAodHlwZSwgY2FsbGJhY2spIHtcclxuICAgIGlmICghZmlsdGVyQnlLZXlWYWx1ZSh0aGlzLmhhbmRsZXJzLCAndHlwZScsIHR5cGUpKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVycy5wdXNoKHtcclxuICAgICAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1lvdSBhbHJlYWR5IGhhdmUgYSBjYWxsYmFjayBmb3IgdHlwZScsIHR5cGUpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkZCBhIG5ldyBmcmFtZSB0byB0aGUgTWFuYWdlciBpbnN0YW5jZS5cclxuICpcclxuICogQHBhcmFtIG5hbWUgdGhlIHVuaXF1ZSBuYW1lIHRvIG1hbmFnZSBhbmQgcmVjaWV2ZSBtZXNzYWdlc1xyXG4gKiBAcGFyYW0gc3JjIHRoZSBzcmMgdXJsIHRoYXQgaXMgZ2l2ZW4gdG8gdGhlIGlmcmFtZS93ZWJ2aWV3XHJcbiAqIEBwYXJhbSBvcHRpb25zIGFuIG9iamVjdCB3aXRoIHZhbHVlcyBmb3Igc3R5bGUsIGF0dHJpYnV0ZXMgYW5kIHVybCBhcmd1bWVudHMgZm9yIHRoZSBzcmNcclxuICogQHJldHVybnMgeyp9XHJcbiAqL1xyXG5NYW5hZ2VyLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAobmFtZSwgc3JjLCBvcHRpb25zKSB7XHJcbiAgICB2YXIgZXhpc3RpbmcgPSBmaWx0ZXJCeUtleVZhbHVlKHRoaXMuZnJhbWVzLCAnbmFtZScsIG5hbWUpO1xyXG4gICAgaWYgKGV4aXN0aW5nKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCdNYW5hZ2VyLmFkZCgpIHRoZXJlIGlzIGFscmVhZHkgYSBmcmFtZSBuYW1lZCcsXHJcbiAgICAgICAgICAgIG5hbWUsICdpbiB0aGUgZnJhbWVyJywgdGhpcy5uYW1lKTtcclxuICAgICAgICByZXR1cm4gZXhpc3Rpbmc7XHJcbiAgICB9XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgICBpZiAoIWlzRGVmaW5lZChvcHRpb25zLnN0eWxlKSkge1xyXG4gICAgICAgIG9wdGlvbnMuc3R5bGUgPSB0aGlzLnN0eWxlO1xyXG4gICAgfVxyXG4gICAgaWYgKCFpc0RlZmluZWQob3B0aW9ucy5hcHBlbmQpKSB7XHJcbiAgICAgICAgb3B0aW9ucy5hcHBlbmQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBmcmFtZSA9IG5ldyBGcmFtZShGcmFtZXJDbGllbnRNZXNzZW5nZXJUeXBlLCBuYW1lLCBzcmMsIG9wdGlvbnMpO1xyXG4gICAgdGhpcy5mcmFtZXMucHVzaChmcmFtZSk7XHJcblxyXG4gICAgcmV0dXJuIGZyYW1lO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIE9wZW4gYSBmcmFtZSBieSBuYW1lIGFuZCBjbG9zZSBhbnkgb3BlbmVkIGZyYW1lcy5cclxuICpcclxuICogQHBhcmFtIG5hbWVcclxuICogQHBhcmFtIG9wdGlvbnNcclxuICovXHJcbk1hbmFnZXIucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAobmFtZSwgb3B0aW9ucykge1xyXG4gICAgdmFyIGV4aXN0aW5nID0gdGhpcy5nZXRGcmFtZShuYW1lKTtcclxuICAgIGlmICghZXhpc3RpbmcpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdNYW5hZ2VyIG9wZW4oKSB0aGVyZSBpcyBubyBmcmFtZSB3aXRoIHRoYXQgbmFtZScsIG5hbWUpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmZvY3VzICYmIHRoaXMuZm9jdXMgIT09IGV4aXN0aW5nKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZUZyYW1lKHRoaXMuZm9jdXMpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5mb2N1cyA9IGV4aXN0aW5nO1xyXG5cclxuICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgbWVyZ2VPcHRpb25zKHRoaXMuZm9jdXMub3B0aW9ucywgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLm9wZW5GcmFtZSh0aGlzLmZvY3VzKTtcclxuXHJcbiAgICByZXR1cm4gZXhpc3Rpbmc7XHJcbn07XHJcblxyXG4vKipcclxuICogT3BlbiBhIGZyYW1lIGJ5IG5hbWUgYW5kIGluc3RlYWQgb2YgY2xvc2luZyBhbnkgb3BlbmVkIGZyYW1lcyxcclxuICogdGhpcyBmcmFtZSB3aWxsIGluc3RlYWQgb3BlbiBhdCBhIHpJbmRleCBhYm92ZSB0aGUgZXhpc3Rpbmcgb3BlbmVkIGZyYW1lLlxyXG4gKlxyXG4gKiBAcGFyYW0gbmFtZVxyXG4gKiBAcGFyYW0gb3B0aW9uc1xyXG4gKi9cclxuTWFuYWdlci5wcm90b3R5cGUub3BlbkFib3ZlID0gZnVuY3Rpb24gKG5hbWUsIG9wdGlvbnMpIHtcclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG4gICAgb3B0aW9ucy5zdHlsZSA9IG9wdGlvbnMuc3R5bGUgfHwge307XHJcblxyXG4gICAgdmFyIGV4aXN0aW5nID0gdGhpcy5nZXRGcmFtZShuYW1lKTtcclxuICAgIGlmICghZXhpc3RpbmcpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdNYW5hZ2VyIG9wZW4oKSB0aGVyZSBpcyBubyBmcmFtZSB3aXRoIHRoYXQgbmFtZScsIG5hbWUpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghb3B0aW9ucy5zdHlsZS56SW5kZXgpIHtcclxuICAgICAgICBvcHRpb25zLnN0eWxlLnpJbmRleCA9IGV4aXN0aW5nLnN0eWxlLnpJbmRleCArIDE7XHJcbiAgICB9XHJcbiAgICB0aGlzLm9wZW5GcmFtZShleGlzdGluZywgb3B0aW9ucyk7XHJcblxyXG4gICAgcmV0dXJuIGV4aXN0aW5nO1xyXG59O1xyXG5cclxuTWFuYWdlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgdmFyIGV4aXN0aW5nID0gdGhpcy5nZXRGcmFtZShuYW1lKTtcclxuICAgIGlmICghZXhpc3RpbmcpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ01hbmFnZXIgY2xvc2UoKSB0aGVyZSBpcyBubyBmcmFtZSB3aXRoIHRoYXQgbmFtZScsIG5hbWUpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuY2xvc2VGcmFtZShleGlzdGluZyk7XHJcbiAgICB0aGlzLmZvY3VzID0gbnVsbDtcclxufTtcclxuXHJcbk1hbmFnZXIucHJvdG90eXBlLmhhbmRsZU1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgdmFyIHJlc3VsdCA9IGZpbHRlckJ5S2V5VmFsdWUodGhpcy5oYW5kbGVycywgJ3R5cGUnLCBtZXNzYWdlLnR5cGUpO1xyXG4gICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgIHJlc3VsdC5jYWxsYmFjay5hcHBseSh0aGlzLCBbbWVzc2FnZS5kYXRhXSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5vcGVuRnJhbWUgPSBmdW5jdGlvbiAoZnJhbWUsIG9wdGlvbnMpIHtcclxuICAgIC8vbWVyZ2UgZXhpc3Rpbmcgb3B0aW9ucyB3aXRoIG92ZXJyaWRlXHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICAgIG1lcmdlT3B0aW9ucyhmcmFtZS5vcHRpb25zLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWZyYW1lLmZyYW1lRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuY3JlYXRlRnJhbWVFbGVtZW50KGZyYW1lKTtcclxuICAgICAgICBpZiAoZnJhbWUub3B0aW9ucy5hcHBlbmQpIHtcclxuICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMuY29udGFpbmVyO1xyXG4gICAgICAgICAgICBpZiAoZnJhbWUub3B0aW9ucy5wYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgIHBhcmVudCA9IGZyYW1lLm9wdGlvbnMucGFyZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHByZXBlbmRFbGVtZW50KHBhcmVudCwgZnJhbWUuZnJhbWVFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignTWFuYWdlcicsIHRoaXMubmFtZSwgJ2FscmVhZHkgaGFzJywgZnJhbWUubmFtZSwgJ29wZW4nKTtcclxuICAgIH1cclxufTtcclxuXHJcbk1hbmFnZXIucHJvdG90eXBlLmNsb3NlRnJhbWUgPSBmdW5jdGlvbiAoZnJhbWUpIHtcclxuICAgIGlmIChmcmFtZS5mcmFtZUVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgY2hpbGRXaW5kb3cgPSBmcmFtZS5mcmFtZUVsZW1lbnQuY29udGVudFdpbmRvdztcclxuICAgICAgICBjb25zb2xlLmxvZygnZnJhbWUgb3B0aW9ucycsIGZyYW1lLm9wdGlvbnMpO1xyXG4gICAgICAgIGlmIChmcmFtZS5vcHRpb25zLmFuZ3VsYXJBcHBJZCAmJiBjaGlsZFdpbmRvdy5hbmd1bGFyKSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXJDbG9zZUZyYW1lV2luZG93KGZyYW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNsb3NlRnJhbWVXaW5kb3coZnJhbWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCdNYW5hZ2VyJywgdGhpcy5uYW1lLCAnZnJhbWUnLCBmcmFtZS5uYW1lLCAnaXMgbm90IG9wZW4gdG8gY2xvc2UnKTtcclxuICAgIH1cclxufTtcclxuXHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5nZXRGcmFtZSA9IGZ1bmN0aW9uIChmcmFtZSkge1xyXG4gICAgdmFyIGV4aXN0aW5nRnJhbWU7XHJcbiAgICBpZiAodHlwZW9mIGZyYW1lID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGV4aXN0aW5nRnJhbWUgPSB0aGlzLmdldEZyYW1lQnlOYW1lKGZyYW1lKVxyXG4gICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhmcmFtZSkubmFtZSkge1xyXG4gICAgICAgIGV4aXN0aW5nRnJhbWUgPSB0aGlzLmZyYW1lcy5pbmRleE9mKGZyYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZXhpc3RpbmdGcmFtZTtcclxufTtcclxuXHJcbk1hbmFnZXIucHJvdG90eXBlLmdldEZyYW1lQnlOYW1lID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgIHZhciBmcmFtZTtcclxuICAgIHZhciByZXN1bHQgPSB0aGlzLmZyYW1lcy5maWx0ZXIoZnVuY3Rpb24gKGZyYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIGZyYW1lLm5hbWUgPT09IG5hbWU7XHJcbiAgICB9KTtcclxuICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGZyYW1lID0gcmVzdWx0WzBdO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmcmFtZTtcclxufTtcclxuXHJcbk1hbmFnZXIucHJvdG90eXBlLmNyZWF0ZUZyYW1lRWxlbWVudCA9IGZ1bmN0aW9uIChmcmFtZSkge1xyXG4gICAgdmFyIHNyYyA9IGZyYW1lLnNyYztcclxuICAgIHZhciBvcHRpb25zID0gZnJhbWUub3B0aW9ucztcclxuICAgIG9wdGlvbnMuYXJndW1lbnRzID0gb3B0aW9ucy5hcmd1bWVudHMgfHwge307XHJcbiAgICBvcHRpb25zLnN0eWxlID0gb3B0aW9ucy5zdHlsZSB8fCB7fTtcclxuICAgIG9wdGlvbnMuYXR0cmlidXRlcyA9IG9wdGlvbnMuYXR0cmlidXRlcyB8fCB7fTtcclxuICAgIHZhciBwYXJhbWV0ZXJzID0gY3JlYXRlVXJsQXJncyhvcHRpb25zLmFyZ3VtZW50cyk7XHJcbiAgICB2YXIgcGFyYW1zID0gJyZuYW1lPScgKyBmcmFtZS5uYW1lICsgJyYnICsgcGFyYW1ldGVycztcclxuICAgIHZhciBvcmlnaW4gPSAnP29yaWdpbj0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGRvY3VtZW50LmxvY2F0aW9uLmhyZWYpO1xyXG5cclxuICAgIC8vdG9kbyB3ZWJ2aWV3IG1zLWFwcC13ZWJ2aWV3XHJcbiAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XHJcblxyXG4gICAgc2V0RWxlbWVudFN0eWxlcyhpZnJhbWUsIG9wdGlvbnMuc3R5bGUpO1xyXG4gICAgc2V0RWxlbWVudEF0dHJpYnV0ZXMoaWZyYW1lLCBvcHRpb25zLmF0dHJpYnV0ZXMpO1xyXG5cclxuICAgIGlmcmFtZS5pZCA9IGZyYW1lLm5hbWU7XHJcbiAgICBpZnJhbWUuc3JjID0gc3JjICsgb3JpZ2luICsgcGFyYW1zO1xyXG4gICAgaWZyYW1lLnNhbmRib3ggPSAnYWxsb3ctZm9ybXMgYWxsb3ctc2NyaXB0cyBhbGxvdy1zYW1lLW9yaWdpbic7XHJcbiAgICBmcmFtZS5mcmFtZUVsZW1lbnQgPSBpZnJhbWU7XHJcblxyXG4gICAgcmV0dXJuIGZyYW1lO1xyXG59O1xyXG5cclxuXHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5jcmVhdGVGcmFtZUNvbnRhaW5lciA9IGZ1bmN0aW9uIChjbGFzc05hbWUpIHtcclxuICAgIHZhciBjb250YWluZXI7XHJcbiAgICBpZiAoIWVsZW1lbnRFeGlzdHNCeUNsYXNzTmFtZShjbGFzc05hbWUpKSB7XHJcbiAgICAgICAgY29udGFpbmVyID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBjbGFzc05hbWU7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJztcclxuICAgICAgICBjb250YWluZXIuc3R5bGUudG9wID0gMDtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUubGVmdCA9IDA7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLnpJbmRleCA9IHRoaXMuekluZGV4O1xyXG4gICAgICAgIHByZXBlbmRFbGVtZW50KHdpbmRvdy5kb2N1bWVudC5ib2R5LCBjb250YWluZXIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcclxufTsiLCJmdW5jdGlvbiBDbGllbnQoKSB7XHJcbiAgICB0aGlzLmhhbmRsZXJzID0gW107XHJcblxyXG4gICAgdGhpcy5wYXJhbXMgPSBwYXJzZVBhcmFtcygpO1xyXG4gICAgdmFyIG5hbWUgPSBmaWx0ZXJCeUtleVZhbHVlKHRoaXMucGFyYW1zLCAnbmFtZScsICduYW1lJywgdHJ1ZSk7XHJcbiAgICB2YXIgb3JpZ2luID0gZmlsdGVyQnlLZXlWYWx1ZSh0aGlzLnBhcmFtcywgJ25hbWUnLCAnb3JpZ2luJyk7XHJcbiAgICBpZiAoIWlzRGVmaW5lZChuYW1lKSB8fCAhaXNEZWZpbmVkKG9yaWdpbikpIHtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ01hbmFnZXIgd2lsbCBub3Qgd29yayB3aXRob3V0IHRoZSBjb3JyZWN0IG9yaWdpbiBhbmQgbmFtZSB1cmwgYXJncycpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMubmFtZSA9IG5hbWUuZGF0YTtcclxuICAgIHRoaXMub3JpZ2luID0gb3JpZ2luLmRhdGE7XHJcblxyXG4gICAgdGhpcy5yZWNlaXZlTWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIGlmIChldmVudC5vcmlnaW4gIT09IGRvY3VtZW50LmxvY2F0aW9uLm9yaWdpbikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZXZlbnQuZGF0YS5tZXNzZW5nZXIgPT09IEZyYW1lck1lc3NlbmdlclR5cGUgJiZcclxuICAgICAgICAgICAgKGV2ZW50LmRhdGEudGFyZ2V0ID09PSB0aGlzLm5hbWUgfHwgdHlwZW9mIGV2ZW50LmRhdGEudGFyZ2V0ID09PSAndW5kZWZpbmVkJykpIHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVNZXNzYWdlKGV2ZW50LmRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH0uYmluZCh0aGlzKTtcclxuXHJcbiAgICB3aW5kb3cucGFyZW50LndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5yZWNlaXZlTWVzc2FnZSwgZmFsc2UpO1xyXG59XHJcblxyXG5DbGllbnQucHJvdG90eXBlLmhhbmRsZU1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgdmFyIHJlc3VsdCA9IGZpbHRlckJ5S2V5VmFsdWUodGhpcy5oYW5kbGVycywgJ3R5cGUnLCBtZXNzYWdlLnR5cGUpO1xyXG4gICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgIHJlc3VsdC5jYWxsYmFjay5hcHBseSh0aGlzLCBbbWVzc2FnZS5kYXRhXSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5DbGllbnQucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAodHlwZSwgZGF0YSwgdGFyZ2V0KSB7XHJcbiAgICB2YXIgbWVzc2FnZSA9IG5ldyBGcmFtZU1lc3NhZ2UodHlwZSwgZGF0YSwgdGhpcy5uYW1lLCB0YXJnZXQsIEZyYW1lckNsaWVudE1lc3NlbmdlclR5cGUpO1xyXG4gICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZShtZXNzYWdlLCB0aGlzLm9yaWdpbik7XHJcbn07XHJcblxyXG5DbGllbnQucHJvdG90eXBlLnJlY2VpdmUgPSBmdW5jdGlvbiAodHlwZSwgY2FsbGJhY2spIHtcclxuICAgIGlmICghZmlsdGVyQnlLZXlWYWx1ZSh0aGlzLmhhbmRsZXJzLCAndHlwZScsIHR5cGUpKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVycy5wdXNoKHtcclxuICAgICAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1lvdSBhbHJlYWR5IGhhdmUgYSBjYWxsYmFjayBmb3IgdHlwZScsIG5hbWUpO1xyXG4gICAgfVxyXG59OyIsImZ1bmN0aW9uIGFuZ3VsYXJDbG9zZUZyYW1lV2luZG93KGZyYW1lKSB7XHJcbiAgICB2YXIgY2hpbGRXaW5kb3cgPSBmcmFtZS5mcmFtZUVsZW1lbnQuY29udGVudFdpbmRvdztcclxuICAgIHZhciBuZ0FwcCA9IGNoaWxkV2luZG93LmFuZ3VsYXIuZWxlbWVudChjaGlsZFdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChmcmFtZS5vcHRpb25zLmFuZ3VsYXJBcHBJZCkpO1xyXG4gICAgY29uc29sZS5sb2coJ25nQXBwJywgbmdBcHApO1xyXG5cclxuICAgIHZhciBpbmplY3RvciA9IGNoaWxkV2luZG93LmFuZ3VsYXIuZWxlbWVudChuZ0FwcCkuaW5qZWN0b3IoKTtcclxuICAgIGRlc3Ryb3lBbGxTY29wZXMoKTtcclxuXHJcbiAgICBmdW5jdGlvbiBkZXN0cm95QWxsU2NvcGVzKCkge1xyXG4gICAgICAgIHZhciByb290U2NvcGUgPSBpbmplY3Rvci5nZXQoJyRyb290U2NvcGUnKTtcclxuICAgICAgICByb290U2NvcGUuJGJyb2FkY2FzdChcIiRkZXN0cm95XCIpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjbG9zZUZyYW1lV2luZG93KGZyYW1lKTtcclxuICAgICAgICB9LCAwKTtcclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==