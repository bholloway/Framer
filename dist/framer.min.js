(function (window) {
"use strict";

function Manager(e){this.name=e,this.frames=[],this.handlers=[],this.focus=null,this.zIndex=99999,this.container=this.createFrameContainer(this.name),this.style={position:"fixed",top:"0px",left:"0px",bottom:"0px",right:"0px",width:"100%",height:"100%",border:"none",margin:"0",padding:"0",overflow:"hidden"},this.receiveMessage=function(e){e.origin===document.location.origin&&(e.data.messenger!==FramerClientMessengerType||e.data.target!==this.name&&"undefined"!=typeof e.data.target||this.handleMessage(e.data))}.bind(this),window.addEventListener("message",this.receiveMessage,!1)}function angularCloseFrameWindow(e){function t(){var t=a.get("$rootScope");t.$broadcast("$destroy"),setTimeout(function(){closeFrameWindow(e)},0)}var n=e.frameElement.contentWindow,r=n.angular.element(n.document.getElementById(e.options.angularAppId));console.log("ngApp",r);var a=n.angular.element(r).injector();t()}function closeFrameWindow(e){setTimeout(function(){try{e.frameElement.src="about:blank"}catch(t){}setTimeout(function(){e.frameElement.parentNode.removeChild(e.frameElement),e.frameElement=void 0},100)},0)}function Frame(e,t,n,r){this.type=e,this.name=t,this.src=n,this.options=r,this.frameElement=void 0}function Client(){this.handlers=[],this.params=parseParams();var e=filterByKeyValue(this.params,"name","name",!0),t=filterByKeyValue(this.params,"name","origin");return isDefined(e)&&isDefined(t)?(this.name=e.data,this.origin=t.data,this.receiveMessage=function(e){e.origin===document.location.origin&&(e.data.messenger!==FramerMessengerType||e.data.target!==this.name&&"undefined"!=typeof e.data.target||this.handleMessage(e.data))}.bind(this),void window.parent.window.addEventListener("message",this.receiveMessage,!1)):void console.info("Manager will not work without the correct origin and name url args")}function FrameMessage(e,t,n,r,a){this.type=e,this.data=t,this.origin=n,this.target=r,this.messenger=a}function createUrlArgs(e){var t=[],n=Object.getOwnPropertyNames(e);return n.forEach(function(n){var r=n+"="+encodeURI(e[n]);t.push(r)}),t.join("&")}function mergeOptions(e,t){var n=Object.getOwnPropertyNames(t);n.forEach(function(n){"undefined"==typeof e[n]&&(e[n]=t[n])})}function filterByKeyValue(e,t,n,r){var a,o=e.filter(function(e){return e[t]===n});if(o.length>0){var s=0;r&&(s=o.length-1),a=o[s]}return a}function parseParams(e){e=e||resolveHashSearch();var t=[],n=parseUris(e);for(var r in n)t.push({name:r,data:n[r]});return t}function resolveHashSearch(){if(""!==document.location.search)return document.location.search;var e=document.location.hash,t=e.substring(e.indexOf("?")+1,e.length);return t}function tryDecodeURIComponent(e){try{return decodeURIComponent(e)}catch(t){console.error("There was an issue parsing the uri segment, check your iframe src",t)}}function parseUris(e){e=e.replace(/^\?/,"");for(var t,n,r={},a=(e||"").split("&"),o=0;o<a.length;o++){var s=a[o];if(s&&(t=s.replace(/\+/g,"%20").split("="),n=tryDecodeURIComponent(t[0]),isDefined(n))){var i=isDefined(t[1])?tryDecodeURIComponent(t[1]):!0;hasOwnProperty.call(r,n)?isArray(r[n])?r[n].push(i):r[n]=[r[n],i]:r[n]=i}}return r}function prependElement(e,t){return e.insertBefore(t,e.firstChild)}function setElementStyles(e,t){for(var n in t)e.style[n]=t[n]}function setElementAttributes(e,t){for(var n in t)e.setAttribute(n,t[n]);return e}function elementExistsByClassName(e){var t=window.document.getElementsByClassName(e);return t.length>0}function isDefined(e){return"undefined"!=typeof e}function domLog(e,t){var n="dom-log",r=document.getElementsByClassName(n)[0];r||(r=document.createElement("div"),r.className=n,r.style.position="absolute",r.style.top="0",r.style.right="0",prependElement(window.document.body,r));var a=document.createElement("p");a.innerText=e,a.style.color=t,a.style.fontSize="0.5em",r.appendChild(a)}window.framer={Manager:Manager,Client:Client,domLog:domLog};var FramerClientMessengerType="frame-client",FramerMessengerType="framer";Manager.prototype.send=function(e,t,n){var r=new FrameMessage(e,t,this.name,n,FramerMessengerType);window.postMessage(r,document.location.origin)},Manager.prototype.receive=function(e,t){filterByKeyValue(this.handlers,"type",e)?console.error("You already have a callback for type",e):this.handlers.push({type:e,callback:t})},Manager.prototype.add=function(e,t,n){var r=filterByKeyValue(this.frames,"name",e);if(r)return console.warn("Manager.add() there is already a frame named",e,"in the framer",this.name),r;n=n||{},isDefined(n.style)||(n.style=this.style),isDefined(n.append)||(n.append=!0);var a=new Frame(FramerClientMessengerType,e,t,n);return this.frames.push(a),a},Manager.prototype.open=function(e,t){var n=this.getFrame(e);return n?(this.focus&&this.focus!==n&&this.closeFrame(this.focus),this.focus=n,t&&mergeOptions(this.focus.options,t),this.openFrame(this.focus),n):void console.error("Manager open() there is no frame with that name",e)},Manager.prototype.openAbove=function(e,t){t=t||{},t.style=t.style||{};var n=this.getFrame(e);return n?(t.style.zIndex||(t.style.zIndex=n.style.zIndex+1),this.openFrame(n,t),n):void console.error("Manager open() there is no frame with that name",e)},Manager.prototype.close=function(e){var t=this.getFrame(e);return t?(this.closeFrame(t),void(this.focus=null)):void console.warn("Manager close() there is no frame with that name",e)},Manager.prototype.handleMessage=function(e){var t=filterByKeyValue(this.handlers,"type",e.type);t&&t.callback.apply(this,[e.data])},Manager.prototype.openFrame=function(e,t){if(t&&mergeOptions(e.options,t),e.frameElement)console.warn("Manager",this.name,"already has",e.name,"open");else if(this.createFrameElement(e),e.options.append){var n=this.container;e.options.parent&&(n=e.options.parent),prependElement(n,e.frameElement)}},Manager.prototype.closeFrame=function(e){if(e.frameElement){var t=e.frameElement.contentWindow;console.log("frame options",e.options),e.options.angularAppId&&t.angular?angularCloseFrameWindow(e):closeFrameWindow(e)}else console.warn("Manager",this.name,"frame",e.name,"is not open to close")},Manager.prototype.getFrame=function(e){var t;return"string"==typeof e?t=this.getFrameByName(e):Object.getOwnPropertyNames(e).name&&(t=this.frames.indexOf(e)),t},Manager.prototype.getFrameByName=function(e){var t,n=this.frames.filter(function(t){return t.name===e});return n.length>0&&(t=n[0]),t},Manager.prototype.createFrameElement=function(e){var t=e.src,n=e.options;n.arguments=n.arguments||{},n.style=n.style||{},n.attributes=n.attributes||{};var r=createUrlArgs(n.arguments),a="&name="+e.name+"&"+r,o="?origin="+encodeURIComponent(document.location.href),s=document.createElement("iframe");return setElementStyles(s,n.style),setElementAttributes(s,n.attributes),s.id=e.name,s.src=t+o+a,s.sandbox="allow-forms allow-scripts allow-same-origin",e.frameElement=s,e},Client.prototype.handleMessage=function(e){var t=filterByKeyValue(this.handlers,"type",e.type);t&&t.callback.apply(this,[e.data])},Client.prototype.send=function(e,t,n){var r=new FrameMessage(e,t,this.name,n,FramerClientMessengerType);window.parent.postMessage(r,this.origin)},Client.prototype.receive=function(e,t){filterByKeyValue(this.handlers,"type",e)?console.error("You already have a callback for type",name):this.handlers.push({type:e,callback:t})},Manager.prototype.createFrameContainer=function(e){var t;return elementExistsByClassName(e)||(t=window.document.createElement("div"),t.className=e,t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.zIndex=this.zIndex,prependElement(window.document.body,t)),t};
window.manager=3;
window.util=3;
})(window);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNsaWVudC5qcyIsIkZyYW1lci5qcyIsIk1hbmFnZXIuanMiLCJ1dGlsLmpzIl0sIm5hbWVzIjpbIk1hbmFnZXIiLCJuYW1lIiwidGhpcyIsImZyYW1lcyIsImhhbmRsZXJzIiwiZm9jdXMiLCJ6SW5kZXgiLCJjb250YWluZXIiLCJjcmVhdGVGcmFtZUNvbnRhaW5lciIsInN0eWxlIiwicG9zaXRpb24iLCJ0b3AiLCJsZWZ0IiwiYm90dG9tIiwicmlnaHQiLCJ3aWR0aCIsImhlaWdodCIsImJvcmRlciIsIm1hcmdpbiIsInBhZGRpbmciLCJvdmVyZmxvdyIsInJlY2VpdmVNZXNzYWdlIiwiZXZlbnQiLCJvcmlnaW4iLCJkb2N1bWVudCIsImxvY2F0aW9uIiwiZGF0YSIsIm1lc3NlbmdlciIsIkZyYW1lckNsaWVudE1lc3NlbmdlclR5cGUiLCJ0YXJnZXQiLCJoYW5kbGVNZXNzYWdlIiwiYmluZCIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJhbmd1bGFyQ2xvc2VGcmFtZVdpbmRvdyIsImZyYW1lIiwiZGVzdHJveUFsbFNjb3BlcyIsInJvb3RTY29wZSIsImluamVjdG9yIiwiZ2V0IiwiJGJyb2FkY2FzdCIsInNldFRpbWVvdXQiLCJjbG9zZUZyYW1lV2luZG93IiwiY2hpbGRXaW5kb3ciLCJmcmFtZUVsZW1lbnQiLCJjb250ZW50V2luZG93IiwibmdBcHAiLCJhbmd1bGFyIiwiZWxlbWVudCIsImdldEVsZW1lbnRCeUlkIiwib3B0aW9ucyIsImFuZ3VsYXJBcHBJZCIsImNvbnNvbGUiLCJsb2ciLCJzcmMiLCJleCIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsInVuZGVmaW5lZCIsIkZyYW1lIiwidHlwZSIsIkNsaWVudCIsInBhcmFtcyIsInBhcnNlUGFyYW1zIiwiZmlsdGVyQnlLZXlWYWx1ZSIsImlzRGVmaW5lZCIsIkZyYW1lck1lc3NlbmdlclR5cGUiLCJwYXJlbnQiLCJpbmZvIiwiRnJhbWVNZXNzYWdlIiwiY3JlYXRlVXJsQXJncyIsImFyZ3MiLCJhcmdzTGlzdCIsInByb3BlcnRpZXMiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwiZm9yRWFjaCIsImVuY29kZWRBcmciLCJlbmNvZGVVUkkiLCJwdXNoIiwiam9pbiIsIm1lcmdlT3B0aW9ucyIsImV4aXN0aW5nIiwiY3VzdG9tIiwia2V5cyIsImtleSIsImNvbGxlY3Rpb24iLCJ2YWx1ZSIsImxhc3QiLCJuZWVkbGUiLCJyZXN1bHQiLCJmaWx0ZXIiLCJpdGVtIiwibGVuZ3RoIiwicmVzdWx0SW5kZXgiLCJoYXNoIiwicmVzb2x2ZUhhc2hTZWFyY2giLCJwYXJhbWV0ZXJzIiwic2VnbWVudHMiLCJwYXJzZVVyaXMiLCJzZWFyY2giLCJzdHJpcHBlZEhhc2giLCJzdWJzdHJpbmciLCJpbmRleE9mIiwidHJ5RGVjb2RlVVJJQ29tcG9uZW50IiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiZXJyb3IiLCJrZXlWYWx1ZSIsInJlcGxhY2UiLCJzZWdtZW50UmVzdWx0cyIsInNwbGl0IiwiaSIsImtWYWx1ZSIsInZhbCIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImlzQXJyYXkiLCJwcmVwZW5kRWxlbWVudCIsInBhcmVudEVsZW1lbnQiLCJpbnNlcnRCZWZvcmUiLCJmaXJzdENoaWxkIiwic2V0RWxlbWVudFN0eWxlcyIsInN0eWxlcyIsInNldEVsZW1lbnRBdHRyaWJ1dGVzIiwiYXR0cmlidXRlcyIsImF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsImVsZW1lbnRFeGlzdHNCeUNsYXNzTmFtZSIsImNsYXNzTmFtZSIsImV4aXN0aW5nRWxlbWVudHMiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiZG9tTG9nIiwibWVzc2FnZSIsImNvbG9yIiwiY3JlYXRlRWxlbWVudCIsImJvZHkiLCJsb2dNZXNzYWdlIiwiaW5uZXJUZXh0IiwiZm9udFNpemUiLCJhcHBlbmRDaGlsZCIsImZyYW1lciIsInByb3RvdHlwZSIsInNlbmQiLCJwb3N0TWVzc2FnZSIsInJlY2VpdmUiLCJjYWxsYmFjayIsImFkZCIsIndhcm4iLCJhcHBlbmQiLCJvcGVuIiwiZ2V0RnJhbWUiLCJjbG9zZUZyYW1lIiwib3BlbkZyYW1lIiwib3BlbkFib3ZlIiwiY2xvc2UiLCJhcHBseSIsImNyZWF0ZUZyYW1lRWxlbWVudCIsImV4aXN0aW5nRnJhbWUiLCJnZXRGcmFtZUJ5TmFtZSIsImFyZ3VtZW50cyIsImVuY29kZVVSSUNvbXBvbmVudCIsImhyZWYiLCJpZnJhbWUiLCJpZCIsInNhbmRib3giLCJtYW5hZ2VyIiwidXRpbCJdLCJtYXBwaW5ncyI6IkFBQUE7QUNnQkEsUUFBU0EsU0FBUUMsR0FDYkMsS0FBS0QsS0FBT0EsRUFDWkMsS0FBS0MsVUFDTEQsS0FBS0UsWUFDTEYsS0FBS0csTUFBUSxLQUNiSCxLQUFLSSxPQUFTLE1BQ2RKLEtBQUtLLFVBQVlMLEtBQUtNLHFCQUFxQk4sS0FBS0QsTUFHaERDLEtBQUtPLE9BQ0RDLFNBQVUsUUFDVkMsSUFBSyxNQUNMQyxLQUFNLE1BQ05DLE9BQVEsTUFDUkMsTUFBTyxNQUNQQyxNQUFPLE9BQ1BDLE9BQVEsT0FDUkMsT0FBUSxPQUNSQyxPQUFRLElBQ1JDLFFBQVMsSUFDVEMsU0FBVSxVQUdkbEIsS0FBS21CLGVBQWlCLFNBQVVDLEdBQ3hCQSxFQUFNQyxTQUFXQyxTQUFTQyxTQUFTRixTQUluQ0QsRUFBTUksS0FBS0MsWUFBY0MsMkJBQ3hCTixFQUFNSSxLQUFLRyxTQUFXM0IsS0FBS0QsTUFBcUMsbUJBQXRCcUIsR0FBTUksS0FBS0csUUFDdEQzQixLQUFLNEIsY0FBY1IsRUFBTUksUUFFL0JLLEtBQUs3QixNQUVQOEIsT0FBT0MsaUJBQWlCLFVBQVcvQixLQUFLbUIsZ0JBQWdCLEdBa0s1RCxRQUFTYSx5QkFBd0JDLEdBUTdCLFFBQVNDLEtBQ0wsR0FBSUMsR0FBWUMsRUFBU0MsSUFBSSxhQUM3QkYsR0FBVUcsV0FBVyxZQUNyQkMsV0FBVyxXQUNQQyxpQkFBaUJQLElBQ2xCLEdBWlAsR0FBSVEsR0FBY1IsRUFBTVMsYUFBYUMsY0FDakNDLEVBQVFILEVBQVlJLFFB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S0FBTTRCLEVBQVFELDBCQUM5REksUUFBT21DLE9BQU80RSxZQUFZWCxFQUFTbEksS0FBS3FCLFNBRzVDc0MsT0FBT2dGLFVBQVVHLFFBQVUsU0FBVXBGLEVBQU1xRixHQUNsQ2pGLGlCQUFpQjlELEtBQUtFLFNBQVUsT0FBUXdELEdBTXpDUixRQUFRc0QsTUFBTSx1Q0FBd0N6RyxNQUx0REMsS0FBS0UsU0FBUzJFLE1BQ1ZuQixLQUFNQSxFQUNOcUYsU0FBVUEsS0FPdEJqSixRQUFRNkksVUFBVXJJLHFCQUF1QixTQUFVd0gsR0FDL0MsR0FBSXpILEVBVUosT0FUS3dILDBCQUF5QkMsS0FDMUJ6SCxFQUFZeUIsT0FBT1IsU0FBUzhHLGNBQWMsT0FDMUMvSCxFQUFVeUgsVUFBWUEsRUFDdEJ6SCxFQUFVRSxNQUFNQyxTQUFXLFFBQzNCSCxFQUFVRSxNQUFNRSxJQUFNLEVBQ3RCSixFQUFVRSxNQUFNRyxLQUFPLEVBQ3ZCTCxFQUFVRSxNQUFNSCxPQUFTSixLQUFLSSxPQUM5QitHLGVBQWVyRixPQUFPUixTQUFTK0csS0FBTWhJLElBRWxDQTtBQ3hXWHlCLE9BQU9xSSxRQUFTO0FDQWhCckksT0FBT3NJLEtBQU0iLCJmaWxlIjoiZnJhbWVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vd2luZG93LmNsaWVudCA9IDsiLCJ3aW5kb3cuZnJhbWVyID0ge1xyXG4gICAgTWFuYWdlcjogTWFuYWdlcixcclxuICAgIENsaWVudDogQ2xpZW50LFxyXG4gICAgZG9tTG9nOiBkb21Mb2dcclxufTtcclxuXHJcbnZhciBGcmFtZXJDbGllbnRNZXNzZW5nZXJUeXBlID0gJ2ZyYW1lLWNsaWVudCc7XHJcbnZhciBGcmFtZXJNZXNzZW5nZXJUeXBlID0gJ2ZyYW1lcic7XHJcblxyXG4vKipcclxuICogTWFuYWdlciBpcyB0aGUgbWFuYWdlciBvZiBhIHNldCBvZiBpZnJhbWUvd2VidmlldyBlbGVtZW50c1xyXG4gKiB0aGF0IGNhbiBjb21tdW5pY2F0ZSB3aXRoIHNlbmQgYW5kIHJlY2VpdmUuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKi9cclxuZnVuY3Rpb24gTWFuYWdlcihuYW1lKSB7XHJcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgdGhpcy5mcmFtZXMgPSBbXTtcclxuICAgIHRoaXMuaGFuZGxlcnMgPSBbXTtcclxuICAgIHRoaXMuZm9jdXMgPSBudWxsO1xyXG4gICAgdGhpcy56SW5kZXggPSA5OTk5OTtcclxuICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5jcmVhdGVGcmFtZUNvbnRhaW5lcih0aGlzLm5hbWUpO1xyXG4gICAgLy8gVGhlIGRlZmF1bHQgc3R5bGUgd2lsbCBtYWtlIHRoZSBmcmFtZXMgZnVsbHNjcmVlbiBhcyBpZiB0aGlzIGlzIGFcclxuICAgIC8vIHNpbmdsZSBmcmFtZSBhcHBsaWNhdGlvbiA7KVxyXG4gICAgdGhpcy5zdHlsZSA9IHtcclxuICAgICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcclxuICAgICAgICB0b3A6ICcwcHgnLFxyXG4gICAgICAgIGxlZnQ6ICcwcHgnLFxyXG4gICAgICAgIGJvdHRvbTogJzBweCcsXHJcbiAgICAgICAgcmlnaHQ6ICcwcHgnLFxyXG4gICAgICAgIHdpZHRoOiAnMTAwJScsXHJcbiAgICAgICAgaGVpZ2h0OiAnMTAwJScsXHJcbiAgICAgICAgYm9yZGVyOiAnbm9uZScsXHJcbiAgICAgICAgbWFyZ2luOiAnMCcsXHJcbiAgICAgICAgcGFkZGluZzogJzAnLFxyXG4gICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJ1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnJlY2VpdmVNZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKGV2ZW50Lm9yaWdpbiAhPT0gZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChldmVudC5kYXRhLm1lc3NlbmdlciA9PT0gRnJhbWVyQ2xpZW50TWVzc2VuZ2VyVHlwZSAmJlxyXG4gICAgICAgICAgICAoZXZlbnQuZGF0YS50YXJnZXQgPT09IHRoaXMubmFtZSB8fCB0eXBlb2YgZXZlbnQuZGF0YS50YXJnZXQgPT09ICd1bmRlZmluZWQnKSkge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZU1lc3NhZ2UoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgfS5iaW5kKHRoaXMpO1xyXG5cclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5yZWNlaXZlTWVzc2FnZSwgZmFsc2UpO1xyXG59XHJcblxyXG4vKipcclxuICogU2VuZCBhIG1lc3NhZ2UgdG8gYSBDbGllbnQsIGlmIG5vIHRhcmdldCBpcyBzcGVjaWZpZWQgc2VuZCB0byBhbGwuXHJcbiAqIEBwYXJhbSB0eXBlIHRoZSBtZXNzYWdlIHR5cGUgdG8gdXNlIGJhc2VkIHRoYXQgZGVzY3JpYmVzIHRoZSBmZWF0dXJlLCBlZyBzdWJtaXQsIHNlbmQsIGxvZ291dFxyXG4gKiBAcGFyYW0gZGF0YSB0aGUgb2F0XHJcbiAqIEBwYXJhbSB0YXJnZXRcclxuICovXHJcbk1hbmFnZXIucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAodHlwZSwgZGF0YSwgdGFyZ2V0KSB7XHJcbiAgICB2YXIgbWVzc2FnZSA9IG5ldyBGcmFtZU1lc3NhZ2UodHlwZSwgZGF0YSwgdGhpcy5uYW1lLCB0YXJnZXQsIEZyYW1lck1lc3NlbmdlclR5cGUpO1xyXG4gICAgd2luZG93LnBvc3RNZXNzYWdlKG1lc3NhZ2UsIGRvY3VtZW50LmxvY2F0aW9uLm9yaWdpbik7XHJcbn07XHJcblxyXG4vKipcclxuICogUmVjZWl2ZSBhIG1lc3NhZ2Ugb24gYSBNYW5hZ2VyIGluc3RhbmNlLiBUaGUgY2FsbGJhY2sgd2lsbCByZWNpZXZlIHRoZSBkYXRhXHJcbiAqIHZhbHVlIHNlbnQgd2l0aCBNYW5hZ2VyLnByb3RvdHlwZS5zZW5kKClcclxuICogQHBhcmFtIHR5cGVcclxuICogQHBhcmFtIGNhbGxiYWNrXHJcbiAqL1xyXG5NYW5hZ2VyLnByb3RvdHlwZS5yZWNlaXZlID0gZnVuY3Rpb24gKHR5cGUsIGNhbGxiYWNrKSB7XHJcbiAgICBpZiAoIWZpbHRlckJ5S2V5VmFsdWUodGhpcy5oYW5kbGVycywgJ3R5cGUnLCB0eXBlKSkge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaCh7XHJcbiAgICAgICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdZb3UgYWxyZWFkeSBoYXZlIGEgY2FsbGJhY2sgZm9yIHR5cGUnLCB0eXBlKTtcclxuICAgIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZGQgYSBuZXcgZnJhbWUgdG8gdGhlIE1hbmFnZXIgaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lIHRoZSB1bmlxdWUgbmFtZSB0byBtYW5hZ2UgYW5kIHJlY2lldmUgbWVzc2FnZXNcclxuICogQHBhcmFtIHNyYyB0aGUgc3JjIHVybCB0aGF0IGlzIGdpdmVuIHRvIHRoZSBpZnJhbWUvd2Vidmlld1xyXG4gKiBAcGFyYW0gb3B0aW9ucyBhbiBvYmplY3Qgd2l0aCB2YWx1ZXMgZm9yIHN0eWxlLCBhdHRyaWJ1dGVzIGFuZCB1cmwgYXJndW1lbnRzIGZvciB0aGUgc3JjXHJcbiAqIEByZXR1cm5zIHsqfVxyXG4gKi9cclxuTWFuYWdlci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKG5hbWUsIHNyYywgb3B0aW9ucykge1xyXG4gICAgdmFyIGV4aXN0aW5nID0gZmlsdGVyQnlLZXlWYWx1ZSh0aGlzLmZyYW1lcywgJ25hbWUnLCBuYW1lKTtcclxuICAgIGlmIChleGlzdGluZykge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignTWFuYWdlci5hZGQoKSB0aGVyZSBpcyBhbHJlYWR5IGEgZnJhbWUgbmFtZWQnLFxyXG4gICAgICAgICAgICBuYW1lLCAnaW4gdGhlIGZyYW1lcicsIHRoaXMubmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nO1xyXG4gICAgfVxyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgaWYgKCFpc0RlZmluZWQob3B0aW9ucy5zdHlsZSkpIHtcclxuICAgICAgICBvcHRpb25zLnN0eWxlID0gdGhpcy5zdHlsZTtcclxuICAgIH1cclxuICAgIGlmICghaXNEZWZpbmVkKG9wdGlvbnMuYXBwZW5kKSkge1xyXG4gICAgICAgIG9wdGlvbnMuYXBwZW5kID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgZnJhbWUgPSBuZXcgRnJhbWUoRnJhbWVyQ2xpZW50TWVzc2VuZ2VyVHlwZSwgbmFtZSwgc3JjLCBvcHRpb25zKTtcclxuICAgIHRoaXMuZnJhbWVzLnB1c2goZnJhbWUpO1xyXG5cclxuICAgIHJldHVybiBmcmFtZTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBPcGVuIGEgZnJhbWUgYnkgbmFtZSBhbmQgY2xvc2UgYW55IG9wZW5lZCBmcmFtZXMuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lXHJcbiAqIEBwYXJhbSBvcHRpb25zXHJcbiAqL1xyXG5NYW5hZ2VyLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKG5hbWUsIG9wdGlvbnMpIHtcclxuICAgIHZhciBleGlzdGluZyA9IHRoaXMuZ2V0RnJhbWUobmFtZSk7XHJcbiAgICBpZiAoIWV4aXN0aW5nKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignTWFuYWdlciBvcGVuKCkgdGhlcmUgaXMgbm8gZnJhbWUgd2l0aCB0aGF0IG5hbWUnLCBuYW1lKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5mb2N1cyAmJiB0aGlzLmZvY3VzICE9PSBleGlzdGluZykge1xyXG4gICAgICAgIHRoaXMuY2xvc2VGcmFtZSh0aGlzLmZvY3VzKTtcclxuICAgIH1cclxuICAgIHRoaXMuZm9jdXMgPSBleGlzdGluZztcclxuXHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICAgIG1lcmdlT3B0aW9ucyh0aGlzLmZvY3VzLm9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vcGVuRnJhbWUodGhpcy5mb2N1cyk7XHJcblxyXG4gICAgcmV0dXJuIGV4aXN0aW5nO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIE9wZW4gYSBmcmFtZSBieSBuYW1lIGFuZCBpbnN0ZWFkIG9mIGNsb3NpbmcgYW55IG9wZW5lZCBmcmFtZXMsXHJcbiAqIHRoaXMgZnJhbWUgd2lsbCBpbnN0ZWFkIG9wZW4gYXQgYSB6SW5kZXggYWJvdmUgdGhlIGV4aXN0aW5nIG9wZW5lZCBmcmFtZS5cclxuICpcclxuICogQHBhcmFtIG5hbWVcclxuICogQHBhcmFtIG9wdGlvbnNcclxuICovXHJcbk1hbmFnZXIucHJvdG90eXBlLm9wZW5BYm92ZSA9IGZ1bmN0aW9uIChuYW1lLCBvcHRpb25zKSB7XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuICAgIG9wdGlvbnMuc3R5bGUgPSBvcHRpb25zLnN0eWxlIHx8IHt9O1xyXG5cclxuICAgIHZhciBleGlzdGluZyA9IHRoaXMuZ2V0RnJhbWUobmFtZSk7XHJcbiAgICBpZiAoIWV4aXN0aW5nKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignTWFuYWdlciBvcGVuKCkgdGhlcmUgaXMgbm8gZnJhbWUgd2l0aCB0aGF0IG5hbWUnLCBuYW1lKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIW9wdGlvbnMuc3R5bGUuekluZGV4KSB7XHJcbiAgICAgICAgb3B0aW9ucy5zdHlsZS56SW5kZXggPSBleGlzdGluZy5zdHlsZS56SW5kZXggKyAxO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vcGVuRnJhbWUoZXhpc3RpbmcsIG9wdGlvbnMpO1xyXG5cclxuICAgIHJldHVybiBleGlzdGluZztcclxufTtcclxuXHJcbk1hbmFnZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgIHZhciBleGlzdGluZyA9IHRoaXMuZ2V0RnJhbWUobmFtZSk7XHJcbiAgICBpZiAoIWV4aXN0aW5nKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCdNYW5hZ2VyIGNsb3NlKCkgdGhlcmUgaXMgbm8gZnJhbWUgd2l0aCB0aGF0IG5hbWUnLCBuYW1lKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmNsb3NlRnJhbWUoZXhpc3RpbmcpO1xyXG4gICAgdGhpcy5mb2N1cyA9IG51bGw7XHJcbn07XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5oYW5kbGVNZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgIHZhciByZXN1bHQgPSBmaWx0ZXJCeUtleVZhbHVlKHRoaXMuaGFuZGxlcnMsICd0eXBlJywgbWVzc2FnZS50eXBlKTtcclxuICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICByZXN1bHQuY2FsbGJhY2suYXBwbHkodGhpcywgW21lc3NhZ2UuZGF0YV0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuTWFuYWdlci5wcm90b3R5cGUub3BlbkZyYW1lID0gZnVuY3Rpb24gKGZyYW1lLCBvcHRpb25zKSB7XHJcbiAgICAvL21lcmdlIGV4aXN0aW5nIG9wdGlvbnMgd2l0aCBvdmVycmlkZVxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgICBtZXJnZU9wdGlvbnMoZnJhbWUub3B0aW9ucywgb3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFmcmFtZS5mcmFtZUVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmNyZWF0ZUZyYW1lRWxlbWVudChmcmFtZSk7XHJcbiAgICAgICAgaWYgKGZyYW1lLm9wdGlvbnMuYXBwZW5kKSB7XHJcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmNvbnRhaW5lcjtcclxuICAgICAgICAgICAgaWYgKGZyYW1lLm9wdGlvbnMucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnQgPSBmcmFtZS5vcHRpb25zLnBhcmVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwcmVwZW5kRWxlbWVudChwYXJlbnQsIGZyYW1lLmZyYW1lRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ01hbmFnZXInLCB0aGlzLm5hbWUsICdhbHJlYWR5IGhhcycsIGZyYW1lLm5hbWUsICdvcGVuJyk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5jbG9zZUZyYW1lID0gZnVuY3Rpb24gKGZyYW1lKSB7XHJcbiAgICBpZiAoZnJhbWUuZnJhbWVFbGVtZW50KSB7XHJcbiAgICAgICAgdmFyIGNoaWxkV2luZG93ID0gZnJhbWUuZnJhbWVFbGVtZW50LmNvbnRlbnRXaW5kb3c7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2ZyYW1lIG9wdGlvbnMnLCBmcmFtZS5vcHRpb25zKTtcclxuICAgICAgICBpZiAoZnJhbWUub3B0aW9ucy5hbmd1bGFyQXBwSWQgJiYgY2hpbGRXaW5kb3cuYW5ndWxhcikge1xyXG4gICAgICAgICAgICBhbmd1bGFyQ2xvc2VGcmFtZVdpbmRvdyhmcmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjbG9zZUZyYW1lV2luZG93KGZyYW1lKTtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignTWFuYWdlcicsIHRoaXMubmFtZSwgJ2ZyYW1lJywgZnJhbWUubmFtZSwgJ2lzIG5vdCBvcGVuIHRvIGNsb3NlJyk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5mdW5jdGlvbiBhbmd1bGFyQ2xvc2VGcmFtZVdpbmRvdyhmcmFtZSkge1xyXG4gICAgdmFyIGNoaWxkV2luZG93ID0gZnJhbWUuZnJhbWVFbGVtZW50LmNvbnRlbnRXaW5kb3c7XHJcbiAgICB2YXIgbmdBcHAgPSBjaGlsZFdpbmRvdy5hbmd1bGFyLmVsZW1lbnQoY2hpbGRXaW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZnJhbWUub3B0aW9ucy5hbmd1bGFyQXBwSWQpKTtcclxuICAgIGNvbnNvbGUubG9nKCduZ0FwcCcsIG5nQXBwKTtcclxuXHJcbiAgICB2YXIgaW5qZWN0b3IgPSBjaGlsZFdpbmRvdy5hbmd1bGFyLmVsZW1lbnQobmdBcHApLmluamVjdG9yKCk7XHJcbiAgICBkZXN0cm95QWxsU2NvcGVzKCk7XHJcblxyXG4gICAgZnVuY3Rpb24gZGVzdHJveUFsbFNjb3BlcygpIHtcclxuICAgICAgICB2YXIgcm9vdFNjb3BlID0gaW5qZWN0b3IuZ2V0KCckcm9vdFNjb3BlJyk7XHJcbiAgICAgICAgcm9vdFNjb3BlLiRicm9hZGNhc3QoXCIkZGVzdHJveVwiKTtcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY2xvc2VGcmFtZVdpbmRvdyhmcmFtZSk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlRnJhbWVXaW5kb3coZnJhbWUpIHtcclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGZyYW1lLmZyYW1lRWxlbWVudC5zcmMgPSAnYWJvdXQ6YmxhbmsnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgLy8gRG8gbm90aGluZ1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZnJhbWUuZnJhbWVFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZnJhbWUuZnJhbWVFbGVtZW50KTtcclxuICAgICAgICAgICAgZnJhbWUuZnJhbWVFbGVtZW50ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH0sIDEwMCk7XHJcbiAgICB9LCAwKTtcclxufVxyXG5cclxuTWFuYWdlci5wcm90b3R5cGUuZ2V0RnJhbWUgPSBmdW5jdGlvbiAoZnJhbWUpIHtcclxuICAgIHZhciBleGlzdGluZ0ZyYW1lO1xyXG4gICAgaWYgKHR5cGVvZiBmcmFtZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICBleGlzdGluZ0ZyYW1lID0gdGhpcy5nZXRGcmFtZUJ5TmFtZShmcmFtZSlcclxuICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZnJhbWUpLm5hbWUpIHtcclxuICAgICAgICBleGlzdGluZ0ZyYW1lID0gdGhpcy5mcmFtZXMuaW5kZXhPZihmcmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGV4aXN0aW5nRnJhbWU7XHJcbn07XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5nZXRGcmFtZUJ5TmFtZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICB2YXIgZnJhbWU7XHJcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5mcmFtZXMuZmlsdGVyKGZ1bmN0aW9uIChmcmFtZSkge1xyXG4gICAgICAgIHJldHVybiBmcmFtZS5uYW1lID09PSBuYW1lO1xyXG4gICAgfSk7XHJcbiAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICBmcmFtZSA9IHJlc3VsdFswXTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZnJhbWU7XHJcbn07XHJcblxyXG5NYW5hZ2VyLnByb3RvdHlwZS5jcmVhdGVGcmFtZUVsZW1lbnQgPSBmdW5jdGlvbiAoZnJhbWUpIHtcclxuICAgIHZhciBzcmMgPSBmcmFtZS5zcmM7XHJcbiAgICB2YXIgb3B0aW9ucyA9IGZyYW1lLm9wdGlvbnM7XHJcbiAgICBvcHRpb25zLmFyZ3VtZW50cyA9IG9wdGlvbnMuYXJndW1lbnRzIHx8IHt9O1xyXG4gICAgb3B0aW9ucy5zdHlsZSA9IG9wdGlvbnMuc3R5bGUgfHwge307XHJcbiAgICBvcHRpb25zLmF0dHJpYnV0ZXMgPSBvcHRpb25zLmF0dHJpYnV0ZXMgfHwge307XHJcbiAgICB2YXIgcGFyYW1ldGVycyA9IGNyZWF0ZVVybEFyZ3Mob3B0aW9ucy5hcmd1bWVudHMpO1xyXG4gICAgdmFyIHBhcmFtcyA9ICcmbmFtZT0nICsgZnJhbWUubmFtZSArICcmJyArIHBhcmFtZXRlcnM7XHJcbiAgICB2YXIgb3JpZ2luID0gJz9vcmlnaW49JyArIGVuY29kZVVSSUNvbXBvbmVudChkb2N1bWVudC5sb2NhdGlvbi5ocmVmKTtcclxuXHJcbiAgICAvL3RvZG8gd2VidmlldyBtcy1hcHAtd2Vidmlld1xyXG4gICAgdmFyIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xyXG5cclxuICAgIHNldEVsZW1lbnRTdHlsZXMoaWZyYW1lLCBvcHRpb25zLnN0eWxlKTtcclxuICAgIHNldEVsZW1lbnRBdHRyaWJ1dGVzKGlmcmFtZSwgb3B0aW9ucy5hdHRyaWJ1dGVzKTtcclxuXHJcbiAgICBpZnJhbWUuaWQgPSBmcmFtZS5uYW1lO1xyXG4gICAgaWZyYW1lLnNyYyA9IHNyYyArIG9yaWdpbiArIHBhcmFtcztcclxuICAgIGlmcmFtZS5zYW5kYm94ID0gJ2FsbG93LWZvcm1zIGFsbG93LXNjcmlwdHMgYWxsb3ctc2FtZS1vcmlnaW4nO1xyXG4gICAgZnJhbWUuZnJhbWVFbGVtZW50ID0gaWZyYW1lO1xyXG5cclxuICAgIHJldHVybiBmcmFtZTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIEZyYW1lKHR5cGUsIG5hbWUsIHNyYywgb3B0aW9ucykge1xyXG4gICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLnNyYyA9IHNyYztcclxuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICB0aGlzLmZyYW1lRWxlbWVudCA9IHVuZGVmaW5lZDtcclxufVxyXG5cclxuZnVuY3Rpb24gQ2xpZW50KCkge1xyXG4gICAgdGhpcy5oYW5kbGVycyA9IFtdO1xyXG5cclxuICAgIHRoaXMucGFyYW1zID0gcGFyc2VQYXJhbXMoKTtcclxuICAgIHZhciBuYW1lID0gZmlsdGVyQnlLZXlWYWx1ZSh0aGlzLnBhcmFtcywgJ25hbWUnLCAnbmFtZScsIHRydWUpO1xyXG4gICAgdmFyIG9yaWdpbiA9IGZpbHRlckJ5S2V5VmFsdWUodGhpcy5wYXJhbXMsICduYW1lJywgJ29yaWdpbicpO1xyXG4gICAgaWYgKCFpc0RlZmluZWQobmFtZSkgfHwgIWlzRGVmaW5lZChvcmlnaW4pKSB7XHJcbiAgICAgICAgY29uc29sZS5pbmZvKCdNYW5hZ2VyIHdpbGwgbm90IHdvcmsgd2l0aG91dCB0aGUgY29ycmVjdCBvcmlnaW4gYW5kIG5hbWUgdXJsIGFyZ3MnKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLm5hbWUgPSBuYW1lLmRhdGE7XHJcbiAgICB0aGlzLm9yaWdpbiA9IG9yaWdpbi5kYXRhO1xyXG5cclxuICAgIHRoaXMucmVjZWl2ZU1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICBpZiAoZXZlbnQub3JpZ2luICE9PSBkb2N1bWVudC5sb2NhdGlvbi5vcmlnaW4pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGV2ZW50LmRhdGEubWVzc2VuZ2VyID09PSBGcmFtZXJNZXNzZW5nZXJUeXBlICYmXHJcbiAgICAgICAgICAgIChldmVudC5kYXRhLnRhcmdldCA9PT0gdGhpcy5uYW1lIHx8IHR5cGVvZiBldmVudC5kYXRhLnRhcmdldCA9PT0gJ3VuZGVmaW5lZCcpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlTWVzc2FnZShldmVudC5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9LmJpbmQodGhpcyk7XHJcblxyXG4gICAgd2luZG93LnBhcmVudC53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMucmVjZWl2ZU1lc3NhZ2UsIGZhbHNlKTtcclxufVxyXG5cclxuQ2xpZW50LnByb3RvdHlwZS5oYW5kbGVNZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgIHZhciByZXN1bHQgPSBmaWx0ZXJCeUtleVZhbHVlKHRoaXMuaGFuZGxlcnMsICd0eXBlJywgbWVzc2FnZS50eXBlKTtcclxuICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICByZXN1bHQuY2FsbGJhY2suYXBwbHkodGhpcywgW21lc3NhZ2UuZGF0YV0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuQ2xpZW50LnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKHR5cGUsIGRhdGEsIHRhcmdldCkge1xyXG4gICAgdmFyIG1lc3NhZ2UgPSBuZXcgRnJhbWVNZXNzYWdlKHR5cGUsIGRhdGEsIHRoaXMubmFtZSwgdGFyZ2V0LCBGcmFtZXJDbGllbnRNZXNzZW5nZXJUeXBlKTtcclxuICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UobWVzc2FnZSwgdGhpcy5vcmlnaW4pO1xyXG59O1xyXG5cclxuQ2xpZW50LnByb3RvdHlwZS5yZWNlaXZlID0gZnVuY3Rpb24gKHR5cGUsIGNhbGxiYWNrKSB7XHJcbiAgICBpZiAoIWZpbHRlckJ5S2V5VmFsdWUodGhpcy5oYW5kbGVycywgJ3R5cGUnLCB0eXBlKSkge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaCh7XHJcbiAgICAgICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdZb3UgYWxyZWFkeSBoYXZlIGEgY2FsbGJhY2sgZm9yIHR5cGUnLCBuYW1lKTtcclxuICAgIH1cclxufTtcclxuXHJcbk1hbmFnZXIucHJvdG90eXBlLmNyZWF0ZUZyYW1lQ29udGFpbmVyID0gZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xyXG4gICAgdmFyIGNvbnRhaW5lcjtcclxuICAgIGlmICghZWxlbWVudEV4aXN0c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSkpIHtcclxuICAgICAgICBjb250YWluZXIgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xyXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS50b3AgPSAwO1xyXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gMDtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUuekluZGV4ID0gdGhpcy56SW5kZXg7XHJcbiAgICAgICAgcHJlcGVuZEVsZW1lbnQod2luZG93LmRvY3VtZW50LmJvZHksIGNvbnRhaW5lcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29udGFpbmVyO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gRnJhbWVNZXNzYWdlKHR5cGUsIGRhdGEsIG9yaWdpbiwgdGFyZ2V0LCBtZXNzZW5nZXIpIHtcclxuICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgdGhpcy5vcmlnaW4gPSBvcmlnaW47XHJcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcclxuICAgIHRoaXMubWVzc2VuZ2VyID0gbWVzc2VuZ2VyO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVVcmxBcmdzKGFyZ3MpIHtcclxuICAgIHZhciBhcmdzTGlzdCA9IFtdO1xyXG4gICAgdmFyIHByb3BlcnRpZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhhcmdzKTtcclxuXHJcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gcHJvcGVydHlSZXNvbHZlcihuYW1lKSB7XHJcbiAgICAgICAgdmFyIGVuY29kZWRBcmcgPSBuYW1lICsgJz0nICsgZW5jb2RlVVJJKGFyZ3NbbmFtZV0pO1xyXG4gICAgICAgIGFyZ3NMaXN0LnB1c2goZW5jb2RlZEFyZyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gYXJnc0xpc3Quam9pbignJicpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtZXJnZU9wdGlvbnMoZXhpc3RpbmcsIGN1c3RvbSkge1xyXG4gICAgdmFyIGtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhjdXN0b20pO1xyXG4gICAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGV4aXN0aW5nW2tleV0gPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGV4aXN0aW5nW2tleV0gPSBjdXN0b21ba2V5XTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZmlsdGVyQnlLZXlWYWx1ZShjb2xsZWN0aW9uLCBrZXksIHZhbHVlLCBsYXN0KSB7XHJcbiAgICB2YXIgbmVlZGxlO1xyXG4gICAgdmFyIHJlc3VsdCA9IGNvbGxlY3Rpb24uZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW1ba2V5XSA9PT0gdmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICB2YXIgcmVzdWx0SW5kZXggPSAwO1xyXG4gICAgICAgIGlmIChsYXN0KSB7XHJcbiAgICAgICAgICAgIHJlc3VsdEluZGV4ID0gcmVzdWx0Lmxlbmd0aCAtIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5lZWRsZSA9IHJlc3VsdFtyZXN1bHRJbmRleF07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmVlZGxlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwYXJzZVBhcmFtcyhoYXNoKSB7XHJcbiAgICBoYXNoID0gaGFzaCB8fCByZXNvbHZlSGFzaFNlYXJjaCgpO1xyXG4gICAgdmFyIHBhcmFtZXRlcnMgPSBbXTtcclxuXHJcbiAgICB2YXIgc2VnbWVudHMgPSBwYXJzZVVyaXMoaGFzaCk7XHJcbiAgICBmb3IgKHZhciBuYW1lIGluIHNlZ21lbnRzKSB7XHJcbiAgICAgICAgcGFyYW1ldGVycy5wdXNoKHtcclxuICAgICAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICAgICAgZGF0YTogc2VnbWVudHNbbmFtZV1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcGFyYW1ldGVycztcclxufVxyXG5cclxuZnVuY3Rpb24gcmVzb2x2ZUhhc2hTZWFyY2goKSB7XHJcbiAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoICE9PSAnJykge1xyXG4gICAgICAgIHJldHVybiBkb2N1bWVudC5sb2NhdGlvbi5zZWFyY2g7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZhciBoYXNoID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaDtcclxuICAgICAgICB2YXIgc3RyaXBwZWRIYXNoID0gaGFzaC5zdWJzdHJpbmcoaGFzaC5pbmRleE9mKCc/JykgKyAxLCBoYXNoLmxlbmd0aCk7XHJcbiAgICAgICAgcmV0dXJuIHN0cmlwcGVkSGFzaDtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gdHJ5RGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdUaGVyZSB3YXMgYW4gaXNzdWUgcGFyc2luZyB0aGUgdXJpIHNlZ21lbnQsIGNoZWNrIHlvdXIgaWZyYW1lIHNyYycsIGVycm9yKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VVcmlzKGtleVZhbHVlKSB7XHJcbiAgICBrZXlWYWx1ZSA9IGtleVZhbHVlLnJlcGxhY2UoL15cXD8vLCAnJyk7XHJcbiAgICB2YXIgc2VnbWVudFJlc3VsdHMgPSB7fSwgdmFsdWUsIGtleTtcclxuICAgIHZhciBzZWdtZW50cyA9IChrZXlWYWx1ZSB8fCBcIlwiKS5zcGxpdCgnJicpO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWdtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHZhciBrVmFsdWUgPSBzZWdtZW50c1tpXTtcclxuICAgICAgICBpZiAoa1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0ga1ZhbHVlLnJlcGxhY2UoL1xcKy9nLCAnJTIwJykuc3BsaXQoJz0nKTtcclxuICAgICAgICAgICAga2V5ID0gdHJ5RGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlWzBdKTtcclxuICAgICAgICAgICAgaWYgKGlzRGVmaW5lZChrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gaXNEZWZpbmVkKHZhbHVlWzFdKSA/IHRyeURlY29kZVVSSUNvbXBvbmVudCh2YWx1ZVsxXSkgOiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wZXJ0eS5jYWxsKHNlZ21lbnRSZXN1bHRzLCBrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VnbWVudFJlc3VsdHNba2V5XSA9IHZhbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBcnJheShzZWdtZW50UmVzdWx0c1trZXldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlZ21lbnRSZXN1bHRzW2tleV0ucHVzaCh2YWwpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWdtZW50UmVzdWx0c1trZXldID0gW3NlZ21lbnRSZXN1bHRzW2tleV0sIHZhbF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2VnbWVudFJlc3VsdHM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByZXBlbmRFbGVtZW50KHBhcmVudEVsZW1lbnQsIGVsZW1lbnQpIHtcclxuICAgIHJldHVybiBwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShlbGVtZW50LCBwYXJlbnRFbGVtZW50LmZpcnN0Q2hpbGQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFbGVtZW50U3R5bGVzKGVsZW1lbnQsIHN0eWxlcykge1xyXG4gICAgZm9yICh2YXIgc3R5bGUgaW4gc3R5bGVzKSB7XHJcbiAgICAgICAgZWxlbWVudC5zdHlsZVtzdHlsZV0gPSBzdHlsZXNbc3R5bGVdO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFbGVtZW50QXR0cmlidXRlcyhlbGVtZW50LCBhdHRyaWJ1dGVzKSB7XHJcbiAgICBmb3IgKHZhciBhdHRyaWJ1dGUgaW4gYXR0cmlidXRlcykge1xyXG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgYXR0cmlidXRlc1thdHRyaWJ1dGVdKTtcclxuICAgIH1cclxuICAgIHJldHVybiBlbGVtZW50O1xyXG59XHJcblxyXG5mdW5jdGlvbiBlbGVtZW50RXhpc3RzQnlDbGFzc05hbWUoY2xhc3NOYW1lKSB7XHJcbiAgICB2YXIgZXhpc3RpbmdFbGVtZW50cyA9IHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7XHJcbiAgICByZXR1cm4gZXhpc3RpbmdFbGVtZW50cy5sZW5ndGggPiAwO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0RlZmluZWQodmFsdWUpIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnO1xyXG59XHJcblxyXG4vKipcclxuICogU2ltcGxlIHV0aWxpdHkgdG8gbG9nIG1lc3NhZ2VzIHRvIHRoZSBkb20uXHJcbiAqIEBwYXJhbSBtZXNzYWdlXHJcbiAqIEBwYXJhbSBjb2xvclxyXG4gKi9cclxuZnVuY3Rpb24gZG9tTG9nKG1lc3NhZ2UsIGNvbG9yKSB7XHJcbiAgICB2YXIgY2xhc3NOYW1lID0gJ2RvbS1sb2cnO1xyXG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKVswXTtcclxuICAgIGlmICghY29udGFpbmVyKSB7XHJcbiAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS50b3AgPSAnMCc7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLnJpZ2h0ID0gJzAnO1xyXG4gICAgICAgIHByZXBlbmRFbGVtZW50KHdpbmRvdy5kb2N1bWVudC5ib2R5LCBjb250YWluZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBsb2dNZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgbG9nTWVzc2FnZS5pbm5lclRleHQgPSBtZXNzYWdlO1xyXG4gICAgbG9nTWVzc2FnZS5zdHlsZS5jb2xvciA9IGNvbG9yO1xyXG4gICAgbG9nTWVzc2FnZS5zdHlsZS5mb250U2l6ZSA9ICcwLjVlbSc7XHJcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobG9nTWVzc2FnZSk7XHJcbn0iLCJ3aW5kb3cubWFuYWdlciA9MzsiLCJ3aW5kb3cudXRpbCA9MzsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=